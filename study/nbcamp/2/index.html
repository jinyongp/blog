<!doctype html><html lang=ko-kr><head><link rel=canonical href=https://jinyongp.dev><meta name=naver-site-verification content="c36f259891f25bc92e3884c1ceb626a0aaa76146"><meta name=author content="jinyongp"><meta property="og:site_name" content="jinyongp.dev"><meta property="og:title" content="[내배캠] 첫번째 팀 프로젝트"><meta property="og:type" content="website"><meta property="og:url" content="https://jinyongp.dev/study/nbcamp/2/"><meta property="og:description" content="사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다."><meta name=description content="사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다."><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PFTW4CN")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>[내배캠] 첫번째 팀 프로젝트</title><link rel=icon href=https://jinyongp.dev/favicon.png><style>html body{font-family:raleway,sans-serif;background-color:#fff}:root{--accent:RoyalBlue;--border-width:5px}</style><link rel=stylesheet href=https://jinyongp.dev/css/main.css><link rel=stylesheet href=https://jinyongp.dev/css/custom.css><link rel=stylesheet href=https://jinyongp.dev/css/content.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/github-dark-dimmed.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css crossorigin=anonymous><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js></script>
<script>hljs.highlightAll(),hljs.configure({ignoreUnescapedHTML:!0})</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://kit.fontawesome.com/62c573b42c.js crossorigin=anonymous></script>
<script>$(document).on("click",function(){$(".collapse").collapse("hide")})</script><meta name=generator content="Hugo 0.115.3"><script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0YPW4E1C"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SH0YPW4E1C")</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>[내배캠] 첫번째 팀 프로젝트</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/blog>Blog</a></li><li><a href=/study>Study</a></li><li><a href=/projects>Projects</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:dev.jinyongp@gmail.com><i class="fa-solid fa-square-envelope"></i></a></li><li class=navbar-icon><a href=https://github.com/jinyongp/><i class="fa-brands fa-github-square"></i></a></li></ul></div></div></nav><main><div><h2>[내배캠] 첫번째 팀 프로젝트</h2><h5>사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다.</h5><a href=https://jinyongp.dev/tags/nbcamp><kbd class=item-tag>nbcamp</kbd></a>
<a href=https://jinyongp.dev/tags/flutter><kbd class=item-tag>flutter</kbd></a></div><aside id=TOC_Study><span>History</span><nav id=TableOfContents><ul><li><a href=#의존성-주입을-위해-인터페이스-적용하기>의존성 주입을 위해 인터페이스 적용하기</a></li><li><a href=#데이터-송수신-로직-추상화하기>데이터 송수신 로직 추상화하기</a></li></ul></nav></aside><div align=start class=content><p>사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다.</p><p>4일간 진행한 프로젝트로 목적은 앱 개발 전반의 과정을 익히기 위함이지만, 보다 팀원분들과의 소통과 협업 관점에 비중으로 두고 프로젝트를 진행하였습니다.</p><p>프로젝트의 주제는 팀과 팀원의 소개를 담은 앱을 작성하는 것으로, 각자 자신의 소개를 담은 상세 페이지를 작성하고 합치기로 결정하였습니다.
저는 상세 페이지와 더불어 메인 페이지와 각 상세 페이지에서 쓰일 댓글 관리 서비스를 맡았습니다.</p><p>그 중에서도 댓글 관리 서비스를 어떻게 구현했는지 정리해보고자 합니다.</p><p><a href=https://github.com/nbcamp/introduce-e1if target=_blank rel="noopener noreferrer">프로젝트 저장소</a></p><h2 id=의존성-주입을-위해-인터페이스-적용하기>의존성 주입을 위해 인터페이스 적용하기</h2><p>사전캠프에서도 다뤘지만, Service 단에서 <code>shared_preferences</code>를 사용하기 위해 서비스 파일 내에서 직접 불러와서 사용해주는 방식이 아니라 <code>main.dart</code>에서 <code>save</code>와 <code>load</code> 함수를 주입해주는 방식으로 구현했었습니다.</p><p>허나, 아래처럼 <code>save</code> 혹은 <code>load</code> 둘 다 구현해야하는 걸 강제할 수 없었습니다. 또한, <code>shared_preferences</code>외에 다른 걸로 변경할 때도 번거롭습니다</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>WidgetsFlutterBinding</span>.<span style=color:#a6e22e>ensureInitialized</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>SharedPreferences</span> <span style=color:#a6e22e>pref</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>SharedPreferences</span>.<span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>runApp</span>(<span style=color:#a6e22e>MultiProvider</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ChangeNotifierProvider</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>create</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>_</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>MemoService</span>(
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>save</span><span style=color:#f92672>:</span> (String <span style=color:#a6e22e>payload</span>) <span style=color:#66d9ef>async</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>pref</span>.<span style=color:#a6e22e>setString</span>(<span style=color:#e6db74>&#34;memo&#34;</span>, <span style=color:#a6e22e>payload</span>),
</span></span><span style=display:flex><span>          <span style=color:#75715e>// load: () async =&gt; pref.getString(&#34;memo&#34;), // 에러를 발생시키지 않음
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ),
</span></span><span style=display:flex><span>      ),
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>child</span>: <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MyApp</span>(),
</span></span><span style=display:flex><span>  ));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>이를 해결하기 위해 <code>IO</code> 인터페이스를 구현했습니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IO</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#a6e22e>save</span>(String <span style=color:#a6e22e>payload</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>String</span><span style=color:#960050;background-color:#1e0010>?</span>&gt; <span style=color:#a6e22e>load</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>dart에서는 인터페이스를 생성하기 위해 <code>abstract class</code> 키워드를 사용해야 합니다. <code>IO</code> 인터페이스는 <code>save</code>와 <code>load</code> 함수에 대한 명세를 제공합니다. 이를 <code>CommentService</code>에 적용합니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CommentService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChangeNotifier</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>final</span> <span style=color:#a6e22e>Map</span>&lt;<span style=color:#f92672>String</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>List</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>Comment</span>&gt;<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>_comments</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>IO</span><span style=color:#f92672>?</span> <span style=color:#a6e22e>io</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>CommentService</span>({<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>io</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>이제 <code>io</code> 인스턴스를 외부에서 주입해줄 수 있습니다. <code>shared_preferences</code>를 사용할 예정이므로 <code>SharedPreferencesIO</code> 클래스를 생성합니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SharedPreferencesIO</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>IO</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>late</span> <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>SharedPreferences</span>&gt; <span style=color:#a6e22e>pref</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>SharedPreferencesIO() {</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pref</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SharedPreferences</span>.<span style=color:#a6e22e>getInstance</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>@override</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>String</span><span style=color:#960050;background-color:#1e0010>?</span>&gt; <span style=color:#a6e22e>load() {</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>pref</span>.<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>pref</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>pref</span>.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#39;comments&#39;</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>@override</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#a6e22e>save</span>(String <span style=color:#a6e22e>payload</span>) <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pref</span>.<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>pref</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>pref</span>.<span style=color:#a6e22e>setString</span>(<span style=color:#e6db74>&#39;comments&#39;</span>, <span style=color:#a6e22e>payload</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>WidgetsFlutterBinding</span>.<span style=color:#a6e22e>ensureInitialized</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>runApp</span>(<span style=color:#a6e22e>MultiProvider</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ChangeNotifierProvider</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>create</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>_</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>CommentService</span>(
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>io</span>: <span style=color:#66d9ef>SharedPreferencesIO</span>(),
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>      ),
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>child</span>: <span style=color:#66d9ef>MainApp</span>(),
</span></span><span style=display:flex><span>  ));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>구현한 <code>SharedPreferencesIO</code> 클래스를 <code>main.dart</code>에서 <code>CommentService</code>에 주입해줍니다.</p><p>이로써, <code>save</code>와 <code>load</code> 모두 구현해야 함을 강제할 수 있게 되었고, <code>IO</code> 인터페이스를 상속하는 클래스를 여러 개 추가하여 상황에 따라 교체할 수 있어 확장성을 높였습니다.</p><h2 id=데이터-송수신-로직-추상화하기>데이터 송수신 로직 추상화하기</h2><p><code>CommentService</code>에서 내부적으로 데이터를 저장하고 불러오는 <code>_save</code>와 <code>_load</code> 함수가 있었습니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#a6e22e>_save() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>save</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Future</span>.<span style=color:#a6e22e>value</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  String <span style=color:#a6e22e>payload</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>jsonEncode</span>(<span style=color:#a6e22e>_memos</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>m</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>toJson</span>()).<span style=color:#a6e22e>toList</span>());
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>save</span><span style=color:#f92672>!</span>(<span style=color:#a6e22e>payload</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#a6e22e>_load</span>() <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>load</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  String<span style=color:#f92672>?</span> <span style=color:#a6e22e>payload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>load</span><span style=color:#f92672>!</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>payload</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_memos</span>.<span style=color:#a6e22e>clear</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>_memos</span>.<span style=color:#a6e22e>addAll</span>(<span style=color:#a6e22e>jsonDecode</span>(<span style=color:#a6e22e>payload</span>).<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>e</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Memo</span>.<span style=color:#a6e22e>fromJson</span>(<span style=color:#a6e22e>e</span>)));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>여기서 데이터를 String 타입의 payload로 만들거나, 반대로 payload를 데이터로 변환하는 작업을 수행했었습니다.
언뜻보면 null 체크를 하고 종료하는 부분이나 payload를 처리하는 부분은 중복된 부분이기에 별도의 함수로 분리하고 싶었습니다.</p><p>그래서 <code>DataHandler</code> 추상 클래스르 작성하였습니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>mixin</span> <span style=color:#a6e22e>DataHandler</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>IO</span><span style=color:#f92672>?</span> <span style=color:#a6e22e>io</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#66d9ef>import</span>(String <span style=color:#a6e22e>payload</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>String</span>&gt; <span style=color:#66d9ef>export</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#a6e22e>save</span>() <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>io</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Future</span>.<span style=color:#a6e22e>value</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>payload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>export</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>io</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>payload</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#a6e22e>load</span>() <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>io</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Future</span>.<span style=color:#a6e22e>value</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>payload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>io</span><span style=color:#f92672>!</span>.<span style=color:#a6e22e>load</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>payload</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>import</span>(<span style=color:#a6e22e>payload</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>dart에서 mixin을 활용하여 추상 클래스를 작성할 수 있습니다.
<code>save</code>와 <code>load</code> 함수는 이미 구현되어 있어 동일한 작업을 수행하지만, <code>import</code>와 <code>export</code> 함수는 재정의가 필요합니다. 이를 <code>CommentService</code>에 적용합니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UseState</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>final</span> <span style=color:#a6e22e>List</span>&lt;<span style=color:#f92672>Comment</span>&gt; <span style=color:#a6e22e>comments</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>final</span> <span style=color:#66d9ef>void</span> Function(<span style=color:#a6e22e>List</span>&lt;<span style=color:#f92672>Comment</span>&gt; Function()) <span style=color:#a6e22e>setState</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>UseState</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>required</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>comments</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>required</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CommentService</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChangeNotifier</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>DataHandler</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>final</span> <span style=color:#a6e22e>Map</span>&lt;<span style=color:#f92672>String</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>List</span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#a6e22e>Comment</span>&gt;<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>_comments</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>CommentService</span>({<span style=color:#a6e22e>IO</span><span style=color:#f92672>?</span> <span style=color:#a6e22e>io</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>io</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>io</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>load</span>().<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>_</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>notifyListeners</span>());
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// ignore
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>UseState</span> <span style=color:#a6e22e>useState</span>(String <span style=color:#a6e22e>name</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>UseState</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>comments</span>: <span style=color:#66d9ef>List.unmodifiable</span>(<span style=color:#a6e22e>_comments</span>[<span style=color:#a6e22e>name</span>] <span style=color:#f92672>??</span> []),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setState</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>newComments</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_comments</span>[<span style=color:#a6e22e>name</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>newComments</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>notifyListeners</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>save</span>();
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>@override</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>void</span>&gt; <span style=color:#66d9ef>import</span>(String <span style=color:#a6e22e>payload</span>) <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jsonDecode</span>(<span style=color:#a6e22e>payload</span>).<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>values</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>values</span> <span style=color:#66d9ef>is</span><span style=color:#f92672>!</span> <span style=color:#a6e22e>List</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>_comments</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>values</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>value</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Comment</span>.<span style=color:#a6e22e>fromJson</span>(<span style=color:#a6e22e>value</span>)).<span style=color:#a6e22e>toList</span>();
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>@override</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Future</span>&lt;<span style=color:#f92672>String</span>&gt; <span style=color:#66d9ef>export</span>() <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>jsonEncode</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>_comments</span>.<span style=color:#a6e22e>map</span>(
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>values</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>MapEntry</span>(
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>key</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>values</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>comment</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>comment</span>.<span style=color:#a6e22e>toJson</span>()).<span style=color:#a6e22e>toList</span>(),
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>      ),
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>mixin</code>을 상속하기 위해선 <code>with</code> 키워드를 사용해야 합니다. <code>DataHandler</code>를 상속하면서 <code>CommentService</code>에서 구현해야 하는 함수들을 재정의합니다.
<code>import</code>와 <code>export</code> 함수는 단순히 JSON 형태의 stringify와 parse 작업을 수행합니다. 이로써 상속을 통해 중복 코드를 제거하고 함수의 역할을 분리할 수 있었습니다.</p></div><script src=https://giscus.app/client.js data-repo=jinyongp/jinyongp.dev data-repo-id=R_kgDOHJDtcg data-category=Comments data-category-id=DIC_kwDOHJDtcs4CXf7o data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=ko crossorigin=anonymous async></script></main><footer><p class="copyright text-muted">© All rights reserved. Powered by <a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> and <a href=https://github.com/calintat/minimal target=_blank rel="noopener noreferrer">Minimal</a>.</p></footer></body></html>