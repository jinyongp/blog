<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://jinyongp.dev><meta name=naver-site-verification content="c36f259891f25bc92e3884c1ceb626a0aaa76146"><meta name=author content="jinyongp"><meta property="og:site_name" content="jinyongp.dev"><meta property="og:title" content="Data Driven Transformation of DOM"><meta property="og:type" content="website"><meta property="og:url" content="https://jinyongp.dev/posts/d3js/2/"><meta property="og:description" content="d3-selection의 개념과 동작 방식을 코드와 함께 살펴봅니다."><meta name=description content="d3-selection의 개념과 동작 방식을 코드와 함께 살펴봅니다."><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PFTW4CN")</script><title>Data Driven Transformation of DOM</title><link rel=icon href=https://jinyongp.dev/favicon.png><link rel=stylesheet href=https://jinyongp.dev/main.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><style>:root{--accent:65 105 225;--font:Raleway}</style><script src=https://kit.fontawesome.com/62c573b42c.js crossorigin=anonymous></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/rainbow.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script>
<script>hljs.highlightAll(),hljs.configure({ignoreUnescapedHTML:!0})</script><script src=/js/main.js></script></head><body><nav class=shadow-md><div class="layout flex justify-between text-gray-600"><ul class="flex gap-4 py-4"><li class=hover:text-accent><a href=/>Home</a></li><li class=hover:text-accent><a href=/posts class=text-accent>Posts</a></li><li class=hover:text-accent><a href=/series>Series</a></li><li class=hover:text-accent><a href=/learn>Learn</a></li></ul><ul class="flex gap-4 py-4"><li class=hover:text-accent><a href=mailto:dev.jinyongp@gmail.com><i class="fa-solid fa-square-envelope text-xl"></i></a></li><li class=hover:text-accent><a href=https://github.com/jinyongp/><i class="fa-brands fa-github-square text-xl"></i></a></li></ul></div></nav><main class=pb-24><div class=layout><header class=text-center><h1 class="mt-16 mb-12">Data Driven Transformation of DOM</h1><div class="flex justify-between items-center"><div><a href=https://jinyongp.dev/tags/d3.js><kbd class="text-sm bg-accent text-white rounded px-1 py-0.5">d3.js</kbd></a></div><h6>Written on Apr 16, 2022</h6></div><hr class=my-4></header><div class="grid grid-cols-1 gap-2 md:gap-10 md:grid-cols-2 text-slate-700"><div><a href=/posts/d3js/1/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent"><div class="flex items-center gap-1"><i class="fa-solid fa-arrow-left"></i>
<span class=font-bold>PREVIOUS SERIES</span></div><span class="truncate whitespace-nowrap">Simulating Physical Forces</span></a></div><div><a href=/posts/d3js/3/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent text-right"><div class="flex items-center gap-1 justify-end"><span class=font-bold>NEXT SERIES</span>
<i class="fa-solid fa-arrow-right"></i></div><span class="truncate whitespace-nowrap">Panning, Zooming and Dragging</span></a></div></div><hr class=mt-4><article class="content [&_hr]:my-4"><h1 id=introduction>Introduction</h1><p><a href=https://github.com/d3/d3-selection>d3-selection</a>은 데이터를 기반으로 DOM을 조작할 수 있는 다양한 기능을 제공합니다.</p><p>이번 시리즈는 d3-force와 연계하여 Github Follower, Following 관계망 그리기를 목표로 하고 있으므로 구현 과정에서 필요한 부분에 대해서만 다루도록 하겠습니다.</p><p>들어가기 전에 <code>Selection</code> 객체에 대해 알아봅시다. d3-selection으로 선택한 요소는 <a href=https://github.com/d3/d3-selection/blob/main/src/selection/index.js><code>groups</code>와 <code>parents</code> property를 갖는 <code>Selection</code> 객체</a>를 생성합니다. <code>Selection</code> 객체는 선택한 요소를 제어할 수 있는 다양한 메서드를 제공합니다.</p><ul><li>요소 선택: selection, select, selectAll, selectChild, selectChildren, filter, merge</li><li>요소 변경: attr, classed, style, property, text, html, append, insert, remove, clone, sort, order, raise, lower</li><li>데이터 연결: data, join, enter, exit, datum</li><li>이벤트 핸들링: on, dispatch</li><li>제어 흐름: each, call, empty, nodes, size, [Symbol.iterator]()</li></ul><p>d3-selection을 이용하여 선택한 요소에 데이터를 연결하고 그 데이터를 기반으로 요소를 제어할 수 있습니다.</p><p>이제 코드와 함께 d3-selection을 이용하여 간단한 그래프를 그려보겠습니다.</p><hr><h2 id=creating-and-editing>Creating and Editing</h2><p>관계망에 사용할 <code>nodes</code>와 <code>links</code>를 브라우저에 그려주기 위해 d3-selection으로 <code>svg</code>를 생성하고 크기를 설정해줍니다.</p><pre><code class=language-js>const root = d3
  .select('body') // === d3.select(document.body)
  .append('svg')
  .attr('width', '100%')
  .attr('height', '100%')
  .style('display', 'block');
</code></pre><p><code>body</code> 요소를 선택하고 하위에 <code>svg</code> 요소를 추가했습니다. 그리고 <code>attr</code> 메서드와 <code>style</code> 메서드로 <code>svg</code>의 속성과 스타일을 지정했습니다. <code>root</code>엔 <code>svg</code> 요소를 담고 있는 <code>Selection</code> 객체가 할당됩니다.</p><p><code>root</code> 아래 <code>links</code>와 <code>nodes</code>를 각각 묶을 <code>g</code> 요소를 생성합니다. (<code>linkGroup</code>을 먼저 생성해야 뒤에 배치됩니다.)</p><pre><code class=language-js>const linkGroup = root.append('g').attr('id', 'links');
const nodeGroup = root.append('g').attr('id', 'nodes');
</code></pre><p><code>id</code>는 별 다른 역할 없이 식별을 위해 추가해주었습니다.</p><hr><h2 id=joining-data>Joining Data</h2><p>이제 DOM 요소에 데이터를 연결해봅시다. <code>nodeGroup</code> 아래 <code>circle</code>을 배치하고 <code>nodes</code> 데이터를 연결합니다.</p><pre><code class=language-js>const circles = nodeGroup
  .selectAll('circle')
  .data(nodes)
  .join('circle')
  .attr('r', 5)
  .attr('fill', 'blue');
</code></pre><p>얼핏 보면 말이 되는 듯하지만 아직 생성도 하지 않은 <code>circle</code>을 왜 선택하고 있는지 의문이 생깁니다. 각 단계가 생성하는 <code>Selection</code> 객체를 보고 흐름을 이해해봅시다.</p><p><code>nodeGroup.selectAll('circle')</code>은 당연히 빈 <code>Selection</code> 객체를 반환합니다.</p><blockquote><p>💡 당연히 비어있는 <code>Selection</code> 객체를 받을건데 왜 <code>selectAll</code>을 쓸까요?</p><p>이후에 <code>nodes</code>를 추가해야 할 상황이 생긴다면, 기존에 생성되었던 <code>circle</code> 요소와 <code>nodes</code>를 비교하여 추가된 <code>node</code>의 개수만큼 <code>circle</code> 요소를 추가합니다. 즉, 비교를 위해 선택하는 요소와 생성하는 요소는 동일해야 합니다.</p></blockquote><pre><code class=language-js>_groups: [NodeList(0)]
_parents: [g#nodes]
</code></pre><p><code>.data(nodes)</code>는 빈 <code>Selection</code> 객체에 <code>nodes</code> 배열의 길이만큼 연결합니다. <code>jt</code> 객체는 <code>__data__</code> property에 <code>node</code> 정보를 갖고 있습니다.</p><pre><code class=language-js>_enter: [Array(5)]
  0: (5) [jt, jt, jt, jt, jt]
_exit: [Array(0)]
  0: []
_groups: [Array(5)]
  0: (5) [empty × 5]
_parents: [g#nodes]
</code></pre><pre><code class=language-js>_enter: Array(1)
  0: Array(5)
  0: jt {...}
  1: jt {...}
  2: jt {...}
  3: jt {...}
  4: jt
    namespaceURI: &quot;http://www.w3.org/2000/svg&quot;
    ownerDocument: document
    __data__: {id: 5, index: 4, x:...}
_exit: [Array(0)]
_groups: [Array(5)]
_parents: [g#nodes]
</code></pre><p><code>.join('circle')</code>은 <code>.enter().append('circle')</code>과 동일한 단축 표현입니다. <code>.enter()</code>까지 실행한 결과는 아래와 같습니다.</p><pre><code class=language-js>_groups: Array(1)
  0: (5) [jt, jt, jt, jt, jt]
_parents: [g#nodes]
</code></pre><pre><code class=language-js>_groups: Array(1)
  0: Array(5)
    0: jt {ownerDocument: document, namespaceURI: 'http://www.w3.org/2000/svg', ...}
    1: jt {ownerDocument: document, namespaceURI: 'http://www.w3.org/2000/svg', ...}
    2: jt {ownerDocument: document, namespaceURI: 'http://www.w3.org/2000/svg', ...}
    3: jt {ownerDocument: document, namespaceURI: 'http://www.w3.org/2000/svg', ...}
    4: jt
      namespaceURI: &quot;http://www.w3.org/2000/svg&quot;
      ownerDocument: document
      __data__: {id: 5, index: 4, x: ...}
      ...
_parents: [g#nodes]
</code></pre><p><code>enter().append('circle')</code>까지 실행한 결과는 아래와 같습니다.</p><pre><code class=language-js>_groups: Array(1)
  0: Array(5)
    0: circle
    1: circle
    2: circle
    3: circle
    4: circle
      __data__: {id: 5, index: 4, x:...}
      ...
_parents: [g#nodes]
</code></pre><p><code>circle</code> 요소가 연결되었고 <code>circle</code> 내부에 <code>__data__</code>가 결합되었습니다.</p><hr><h2 id=impl>Impl.</h2><p><code>ticked</code> 함수 내부에서 DOM 요소와 결합한 <code>node</code> 객체의 <code>x</code>, <code>y</code> 좌표 데이터를 이용해 요소를 화면 상에 그려보았습니다.</p><p class=codepen data-height=600 data-default-tab=result data-slug-hash=MWrxgPB data-user=jinyongp style="height:600px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em"><span>See the Pen <a href=https://codepen.io/jinyongp/pen/MWrxgPB>D3 Force (w/ SVG)</a> by Park, Jinyong (<a href=https://codepen.io/jinyongp>@jinyongp</a>)
on <a href=https://codepen.io>CodePen</a>.</span></p><script async src=https://cpwebassets.codepen.io/assets/embed/ei.js></script><hr><h2 id=conclusion>Conclusion</h2><p>d3-selection의 개념과 데이터 결합 방법과 흐름에 대해 살펴보았습니다. 저번과 달리 많은 개념에 대해 알아보진 않았지만, 요소를 선택하고 속성을 변경하고 데이터를 결합하는 정말 필요한 내용만 다루면서 d3-force와 연동하여 간단한 그래프를 그려볼 수 있었습니다.</p><p><code>node</code>의 데이터가 많아질수록 d3-selection을 더욱 적극적으로 이용할 예정이므로, 그 때를 위해 이번엔 이 정도로 하고 다음 시리즈에선 d3-zoom과 d3-drag를 이용하여 상호작용하는 방법에 대해 알아보겠습니다.</p><h2 id=references>References</h2><ul><li><a href=https://github.com/d3/d3-selection>d3-selection</a></li><li><a href=https://bost.ocks.org/mike/join/>Thinking with Joins</a></li><li><a href=https://lucidar.me/en/d3.js/part-07-data-binding>D3.js Tutorial - Data Binding</a></li></ul></article><script src=https://giscus.app/client.js data-repo=jinyongp/jinyongp.dev data-repo-id=R_kgDOHJDtcg data-category=Comments data-category-id=DIC_kwDOHJDtcs4CXf7o data-mapping=title data-strict=0 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=ko crossorigin=anonymous async></script></div></main><footer class="absolute bottom-0 w-full"><div class="flex justify-center py-8"><p class=[&_a]:text-accent>© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a>.</p></div></footer><div id=js-scroll-back-to-top class="back-to-top hide fixed bottom-10 right-10 rounded-full w-10 h-10 bg-accent grid place-items-center cursor-pointer"><i class="fa-solid fa-arrow-up text-white"></i></div></body></html>