<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport viewport-fit=cover content="width=device-width"><meta name=HandheldFriendly content="true"><link rel=sitemap type=application/xml href=/sitemap.xml><link rel=canonical href=https://jinyongp.dev/posts/d3js/3/><meta name=naver-site-verification content="c36f259891f25bc92e3884c1ceb626a0aaa76146"><link rel=alternate type=application/rss+xml href=https://jinyongp.dev/feed.xml title=jinyongp.dev><meta name=author content="jinyongp <dev.jinyongp@gmail.com>"><meta name=keywords content="d3.js"><link rel=manifest href=/manifest.webmanifest><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="jinyongp.dev"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta name=theme-color content="rgb(65, 105, 225)"><meta property="og:site_name" content="jinyongp.dev"><meta property="og:title" content="Panning, Zooming and Dragging"><meta property="og:type" content="website"><meta property="og:url" content="https://jinyongp.dev/posts/d3js/3/"><meta property="og:description" content="d3-zoom과 d3-drag의 개념과 동작 방식을 코드와 함께 살펴봅니다."><meta name=description content="d3-zoom과 d3-drag의 개념과 동작 방식을 코드와 함께 살펴봅니다."><title>Panning, Zooming and Dragging</title><link rel=preload href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css><script defer type=module>
    import hljs from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/highlight.min.js";
    import dart from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/languages/dart.min.js";
    hljs.configure({})
    hljs.registerLanguage("dart", dart);
    hljs.highlightAll();
  </script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PFTW4CN")</script><script async>"serviceWorker"in navigator&&navigator.serviceWorker.register("/js/sw.js")</script><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.8/photoswipe.min.css as=style crossorigin=anonymous integrity="sha512-LFWtdAXHQuwUGH9cImO9blA3a3GfQNkpF2uRlhaOpSbDevNyK1rmAjs13mtpjvWyi+flP7zYWboqY+8Mkd42xA==" referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.8/photoswipe.min.css crossorigin=anonymous integrity="sha512-LFWtdAXHQuwUGH9cImO9blA3a3GfQNkpF2uRlhaOpSbDevNyK1rmAjs13mtpjvWyi+flP7zYWboqY+8Mkd42xA==" referrerpolicy=no-referrer><script async type=module src=/js/main.js></script>
<link rel=icon href=https://jinyongp.dev/favicon.ico><link rel=preload href=https://jinyongp.dev/main.min.css as=style><link rel=stylesheet href=https://jinyongp.dev/main.min.css><link rel=preload href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap" as=style><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap"><style>:root{--accent:65 105 225;--font:Raleway}</style></head><body><nav class=shadow-md><div class="layout flex justify-between text-gray-600"><ul class="flex gap-4 py-4"><li class=hover:text-accent><a title=Home href=/>Home</a></li><li class=hover:text-accent><a title=Posts href=/posts class=text-accent>Posts</a></li><li class=hover:text-accent><a title=Learn href=/learn>Learn</a></li><li class=hover:text-accent><a title=Series href=/series>Series</a></li></ul><ul class="flex gap-4 py-4"><li class="hover:text-accent grid place-items-center"><a class=text-xl title=envelope href=mailto:dev.jinyongp@gmail.com target=_blank rel="noopener noreferrer"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M64 112c-8.8.0-16 7.2-16 16v22.1L220.5 291.7c20.7 17 50.4 17 71.1.0L464 150.1V128c0-8.8-7.2-16-16-16H64zM48 212.2V384c0 8.8 7.2 16 16 16H448c8.8.0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64H448c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3.0-64-28.7-64-64V128z"/></svg></i></a></li><li class="hover:text-accent grid place-items-center"><a class=text-xl title=github href=https://github.com/jinyongp/ target=_blank rel="noopener noreferrer"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></i></a></li></ul></div></nav><main><div class=layout><header class=text-center><h1 class="relative mt-16 mb-12 flex justify-center">Panning, Zooming and Dragging</h1><div class="flex justify-between items-center"><div><a href=https://jinyongp.dev/tags/d3.js><kbd class="text-xs bg-accent text-white rounded px-1 py-0.5">d3.js</kbd></a></div><span>Written on Apr 21, 2022</span></div><hr class="my-4 w-full"></header><div class="text-slate-500 grid grid-cols-1 gap-2 md:gap-20 md:grid-cols-2"><div><a href=/posts/d3js/2/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent"><div class="flex items-center gap-1 [&_span]:font-bold"><i class=mb-0.5><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M9.4 233.4c-12.5 12.5-12.5 32.8.0 45.3l160 160c12.5 12.5 32.8 12.5 45.3.0s12.5-32.8.0-45.3L109.2 288H416c17.7.0 32-14.3 32-32s-14.3-32-32-32H109.3L214.6 118.6c12.5-12.5 12.5-32.8.0-45.3s-32.8-12.5-45.3.0l-160 160z"/></svg></i><span>PREV</span></div><span class="truncate whitespace-nowrap">Data Driven Transformation of DOM</span></a></div><div><a href=/posts/d3js/4/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent text-right"><div class="flex items-center gap-1 [&_span]:font-bold justify-end"><span>NEXT</span>
<i class=mb-0.5><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M438.6 278.6c12.5-12.5 12.5-32.8.0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3.0s-12.5 32.8.0 45.3L338.8 224H32c-17.7.0-32 14.3-32 32s14.3 32 32 32h306.7L233.4 393.4c-12.5 12.5-12.5 32.8.0 45.3s32.8 12.5 45.3.0l160-160z"/></svg></i></div><span class="truncate whitespace-nowrap">Refactoring for Performance (Canvas API)</span></a></div></div><hr class=my-4><article class="content [&_hr]:my-4"><h1 id=introduction class="flex items-center gap-3">Introduction <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Introduction href=#introduction><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h1><p><a class=underline-lsre href=https://github.com/d3/d3-zoom target=_blank rel="noopener noreferrer nofollow">d3-zoom</a>과 <a class=underline-lsre href=https://github.com/d3/d3-drag target=_blank rel="noopener noreferrer nofollow">d3-drag</a>는 사용자가 마우스 클릭 혹은 터치로 화면을 제어하거나 요소를 이동하는 기능을 제공합니다.</p><p>이번 시리즈 또한 마찬가지로 저번 시리즈에 구현했던 코드에 d3-zoom과 d3-drag를 결합하는 걸 목표로 하여 그에 필요한 부분만 다루도록 하겠습니다.</p><hr><h2 id=d3-zoom class="flex items-center gap-3">d3-zoom <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=d3-zoom href=#d3-zoom><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>d3-zoom은 사용자가 화면을 드래그 혹은 스크롤하여 현재 보는 범위를 이동, 확대, 축소하는 기능을 제공합니다. 혹은, 특정 요소를 선택했을 때 그 위치로 이동하면서 포커스하는 효과를 줄 수도 있습니다.</p><h3 id=panning-and-zooming class="flex items-center gap-3">Panning and Zooming <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title="Panning and Zooming" href=#panning-and-zooming><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>d3-zoom은 d3-selection과 연계하여 구현합니다. <code>Selection</code> 객체에 zoom 기능을 제공하기 위해 <code>d3.zoom()</code> 함수를 호출하여 전달합니다. 저번 시리즈에서 생성한 <code>root</code> 요소를 가져와 zoom 기능을 추가해보겠습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const zoom = d3
  .zoom()
  .on(&#39;zoom&#39;, (event) =&gt; {
    console.log(&#39;Zoom and Drag!&#39;);
  });

root.call(zoom);</code></pre></div><p><code>d3.zoom()</code> 함수는 <code>Selection</code> 객체를 인자로 받는 함수를 생성하여 반환합니다. <code>root.call(zoom)</code>을 호출함으로써 인자로 받은 <a class=underline-lsre href=https://github.com/d3/d3-zoom/blob/1bccd3fd56ea24e9658bd7e7c24e9b89410c8967/src/zoom.js#L72-L83 target=_blank rel="noopener noreferrer nofollow">객체에 여러 property와 event를 등록</a>하게 됩니다.</p><blockquote><p><a class=underline-lsre href=https://github.com/d3/d3-selection#selection_call target=_blank rel="noopener noreferrer nofollow">selection.call()</a>은 <code>Selection</code> 객체를 인자로 받는 함수를 인자로 받습니다. <code>root.call(zoom)</code>은 다음 코드와 동일합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">zoom(root);</code></pre></div></blockquote><p><code>root</code> 요소를 드래그하거나 스크롤을 해보면 이벤트에 등록한 함수가 실행됩니다. <code>zoom</code> 이벤트에 등록할 함수를 작성하여 요소를 이동시켜봅시다.</p><p>전달한 함수는 <code>event</code> 객체를 매개변수로 가집니다. 클릭 이동인지 스크롤인지에 따라 종류가 달라집니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">// MouseEvent
sourceEvent: MouseEvent {...}
target: ƒ y(t)
transform: Jx {k: x.xx, x: x.xx, y: x.xx}
type: &#34;zoom&#34;

// WheelEvent
sourceEvent: WheelEvent {...}
target: ƒ y(t)
transform: Jx {k: x.xx, x: x.xx, y: x.xx}
type: &#34;zoom&#34;</code></pre></div><p>이 중에서 scale factor인 <code>k</code> 와 translation 값인 <code>x</code>, <code>y</code>를 얻을 수 있는 <code>transform</code> 객체를 이용합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">.on(&#39;zoom&#39;, ({ transform }) =&gt; {
  nodeGroup.attr(&#39;transform&#39;, transform);
  linkGroup.attr(&#39;transform&#39;, transform);
});</code></pre></div><p>저번 시리즈에서 생성한 <code>nodeGroup</code>과 <code>linkGroup</code>은 <code>svg</code> 요소를 가지는 <code>Selection</code> 객체로 <code>transform</code> 속성을 변경하여 위치와 크기를 조절할 수 있습니다.</p><blockquote><p><code>transform</code>은 객체인데 그대로 전달할 수 있는 이유는 적용될 때 <a class=underline-lsre href=https://github.com/d3/d3-zoom#transform_toString target=_blank rel="noopener noreferrer nofollow"><code>transform.toString()</code>함수가 호출되어 <code>"translate(x,y) scale(k)"</code> 형태의 문자열로 변환</a>되기 때문입니다.</p></blockquote><p>화면을 드래그하여 이동하고 스크롤하여 확대, 축소할 수 있습니다.</p><h3 id=focusing class="flex items-center gap-3">Focusing <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Focusing href=#focusing><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>그럼 특정 요소를 클릭했을 때 해당 요소를 포커스하는 동작에 대해 구현해보겠습니다. 일단 <code>Selection</code> 객체에 이벤트를 등록하기 위해선 <code>selection.on()</code> 메서드를 호출합니다. 저번 시리즈에서 생성한 <code>circles</code>를 가져오겠습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">circles.on(&#39;click&#39;, (event, node) =&gt; {
  console.log(&#39;Click!&#39;);
});</code></pre></div><p><code>click</code> 이벤트에 등록한 함수는 <code>event</code>와 <code>node</code> 객체를 매개변수로 가집니다. <code>node</code>의 현재 위치 <code>x</code>, <code>y</code> 좌표로 이동 및 확대해야 하므로 이를 이용합니다.</p><p>사용자의 조작이 아닌 코드를 통해 특정 좌표로 이동하고 확대하기 위해선 <a class=underline-lsre href=https://github.com/d3/d3-zoom#zoom_translateTo target=_blank rel="noopener noreferrer nofollow"><code>zoom.translateTo</code></a>와 <a class=underline-lsre href=https://github.com/d3/d3-zoom#zoom_scaleTo target=_blank rel="noopener noreferrer nofollow"><code>zoom.scaleTo</code></a> 함수를 이용합니다. 해당 함수는 첫 번째 인자로 <code>Selection</code> 객체를 전달받으므로 <code>selection.call()</code> 함수로 호출할 수 있습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">circles.on(&#39;click&#39;, (_, { x, y }) =&gt; {
  root
    .transition()
    .duration(500)
    .call(zoom.translateTo, x, y)
    .transition()
    .call(zoom.scaleTo, 3);
});</code></pre></div><p><code>circles</code> 요소를 클릭하면 클릭한 <code>circle</code>의 <code>x</code>, <code>y</code> 좌표를 가져옵니다. 그리고 <code>zoom.translateTo</code>와 <code>zoom.scaleTo</code>가 <code>root</code> 요소의 zoom 상태를 변경합니다. <code>transition</code>과 <code>duration</code>은 zoom이 이동할 때 transition 효과를 주어 보다 자연스러운 움직임을 제공합니다.</p><hr><h2 id=d3-drag class="flex items-center gap-3">d3-drag <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=d3-drag href=#d3-drag><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>d3-drag는 요소를 클릭하여 드래그하는 기능을 제공합니다.</p><h3 id=dragging class="flex items-center gap-3">Dragging <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Dragging href=#dragging><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>d3-drag 또한 d3-selection에 기능을 제공합니다. <code>d3.drag()</code> 함수는 <code>Selection</code> 객체를 인자로 받는 함수를 생성하여 반환합니다. 추가로, 드래그하기 위해서 필요한 세 가지 이벤트를 등록해야 합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const drag = d3
  .drag()
  .on(&#34;start&#34;, (event, node) =&gt; {
    console.log(&#39;Drag Start!&#39;);
  })
  .on(&#34;drag&#34;, (event, node) =&gt; {
    console.log(&#39;Dragging!&#39;);
  })
  .on(&#34;end&#34;, (event, node) =&gt; {
    console.log(&#39;Drag End!&#39;);
  });

circles.call(drag);</code></pre></div><p>요소를 클릭하면 <code>start</code> 이벤트가 발생하고, 클릭 후 드래그하면 <code>drag</code> 이벤트 그리고 클릭을 떼면 <code>end</code> 이벤트가 발생합니다. 이벤트에 등록한 모든 함수는 클릭 이벤트 객체와 클릭한 요소의 정보를 매개변수로 가집니다.</p><p>요소를 클릭하여 드래그할 때 simulation은 계속 실행 중인 상태여야 합니다. d3-force 시리즈에서 언급한 내용으로 simulation을 종료하지 않고 계속 실행하려면 <code>alphaTarget</code>을 이용해야 합니다.</p><p>또한, 요소가 다른 요소와 상관없이 <a class=underline-lsre href=https://github.com/d3/d3-force#simulation_nodes target=_blank rel="noopener noreferrer nofollow">특정 고정 좌표에 위치하도록 하려면 <code>fx</code>와 <code>fy</code> 값을 설정</a>해야 합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const drag = d3
  .drag()
  .on(&#39;start&#39;, (event, node) =&gt; {
    nodeGroup.style(&#39;cursor&#39;, &#39;grabbing&#39;);
    simulation.alphaTarget(0.1).restart();
  })
  .on(&#39;drag&#39;, (event, node) =&gt; {
    node.fx = event.x;
    node.fy = event.y;
  })
  .on(&#39;end&#39;, (event, node) =&gt; {
    nodeGroup.style(&#39;cursor&#39;, &#39;grab&#39;);
    simulation.alphaTarget(0);
    node.fx = null;
    node.fy = null;
  });

circles.call(drag);</code></pre></div><p>클릭할 때 <code>alphaTarget</code>을 <code>alphaMin</code>보다 크게 설정하여 simulation이 절대 종료되지 않도록 합니다. <code>alphaTarget</code> 값이 클수록 다른 요소의 움직임이 커집니다. 클릭을 종료하면 다시 되돌려놓습니다.</p><p>클릭하여 드래그를 시작하면 <code>fx</code>와 <code>fy</code> 값을 현재 마우스의 위치로 설정합니다. 클릭을 종료하면 <code>null</code>로 설정하여 고정 위치를 제거합니다.</p><hr><h2 id=impl class="flex items-center gap-3">Impl. <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Impl. href=#impl><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>d3-zoom과 d3-drag를 추가해보았습니다. <code>Network</code> class를 작성하여 코드를 정리했고 실시간으로 <code>alpha</code>와 <code>zoom</code> 상태를 확인하고 제어할 수 있도록 구현하였습니다. <code>nodes</code>와 <code>links</code>를 추가할 수 있도록 구현하였습니다. 비어있는 채로 <code>ADD</code>를 클릭하면 새로운 요소가 임의의 요소에 연결됩니다. 그리고 <code>node</code>의 아이디를 DOM에 그려 <code>node</code>의 데이터를 어떻게 DOM에 적용할 수 있는지 보여줬습니다.</p><p class=codepen data-height=600 data-default-tab=result data-slug-hash=mdpoWxa data-user=jinyongp style="height:300px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em"><span>See the Pen <a href=https://codepen.io/jinyongp/pen/mdpoWxa>D3 Force, Zoom, Drag (w/ SVG)</a> by Park, Jinyong (<a href=https://codepen.io/jinyongp>@jinyongp</a>)
on <a href=https://codepen.io>CodePen</a>.</span></p><script async src=https://cpwebassets.codepen.io/assets/embed/ei.js></script><hr><h2 id=conclusion class="flex items-center gap-3">Conclusion <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Conclusion href=#conclusion><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>d3-zoom과 d3-drag를 기존 프로젝트에 연결하는 코드를 작성해보면서 개념과 구현 방법에 대해 알아보았습니다. 여기서 사용해본 기능 말고도 d3는 정말 많은 기능을 제공합니다. 공식 문서에 예시가 살짝 아쉽긴 하지만, 직접 사용해보면서 그 유틸성을 확인해보았으면 합니다.</p><p><code>ADD</code> 버튼을 눌러 계속 요소를 추가하다보면 점점 프레임이 떨어지면서 성능이 하락하는 모습을 볼 수 있습니다. 이 문제는 HTML5 Canvas API가 해결할 수 있습니다. 허나, 이 방법도 그리기엔 쉬울지 몰라도 오늘 적용한 zoom과 drag 기능을 추가하는데엔 어려움이 있습니다. 다음 시리즈는 지금까지 구현한 내용을 Canvas API로 리팩토링하면서 전부 알아보도록 하겠습니다.</p><hr><h2 id=references class="flex items-center gap-3">References <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=References href=#references><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><ul><li><a class=underline-lsre href=https://github.com/d3/d3-zoom target=_blank rel="noopener noreferrer nofollow">d3-zoom</a></li><li><a class=underline-lsre href=https://github.com/d3/d3-drag target=_blank rel="noopener noreferrer nofollow">d3-drag</a></li><li><a class=underline-lsre href=https://github.com/d3/d3-transition target=_blank rel="noopener noreferrer nofollow">d3-transition</a></li></ul></article><script src=https://giscus.app/client.js data-repo=jinyongp/jinyongp.dev data-repo-id=R_kgDOHJDtcg data-category=Comments data-category-id=DIC_kwDOHJDtcs4CXf7o data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=ko crossorigin=anonymous async></script><div class=h-24></div></div></main><footer class="absolute bottom-0 w-full"><div class="flex justify-center py-8"><p class="[&_a]:text-accent text-center text-sm">Copyright 2023. Jinyong Park. All rights reserved.<br><span class=text-xs>Powered by <a class=underline-lsre href=https://gohugo.io target=_blank rel="noopener noreferrer nofollow">Hugo</a></span></p></div></footer><div id=js-scroll-back-to-top class="back-to-top hide fixed bottom-10 right-10 rounded-full w-10 h-10 bg-white border border-accent grid place-items-center cursor-pointer"><i class=text-accent><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><path d="M288 0c17.7.0 32 14.3 32 32V49.7C451.8 63.4 557.7 161 573.9 285.9c2 15.6-17.3 24.4-27.8 12.7C532.1 283 504.8 272 480 272c-38.7.0-71 27.5-78.4 64.1-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C359 299.5 326.7 272 288 272s-71 27.5-78.4 64.1c-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C167 299.5 134.7 272 96 272c-24.8.0-52.1 11-66.1 26.7C19.4 310.4.1 301.5 2.1 285.9 18.3 161 124.2 63.4 256 49.7V32c0-17.7 14.3-32 32-32zm0 304c12.3.0 23.5 4.6 32 12.2V430.6c0 45-36.5 81.4-81.4 81.4-30.8.0-59-17.4-72.8-45l-2.3-4.7c-7.9-15.8-1.5-35 14.3-42.9s35-1.5 42.9 14.3l2.3 4.7c3 5.9 9 9.6 15.6 9.6 9.6.0 17.4-7.8 17.4-17.4V316.2c8.5-7.6 19.7-12.2 32-12.2z"/></svg></i></div></body></html>