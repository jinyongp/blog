<!doctype html><html lang=ko><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0YPW4E1C"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SH0YPW4E1C")</script><meta charset=utf-8><meta name=viewport viewport-fit=cover content="width=device-width"><meta name=HandheldFriendly content="true"><meta name=robots content="index,follow"><link rel=sitemap type=application/xml href=/sitemap.xml><link rel=canonical href=https://jinyongp.dev/posts/d3js/1/><meta name=naver-site-verification content="c36f259891f25bc92e3884c1ceb626a0aaa76146"><link rel=alternate type=application/rss+xml href=https://jinyongp.dev/feed.xml title=jinyongp.dev><meta name=author content="jinyongp <dev.jinyongp@gmail.com>"><meta name=keywords content="d3.js"><link rel=manifest href=/manifest.webmanifest><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="jinyongp.dev"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta name=theme-color content="rgb(65, 105, 225)"><meta property="og:site_name" content="jinyongp.dev"><meta property="og:title" content="Simulating Physical Forces"><meta property="og:type" content="website"><meta property="og:url" content="https://jinyongp.dev/posts/d3js/1/"><meta property="og:description" content="d3-force의 개념과 동작 방식을 코드와 함께 살펴봅니다."><meta name=description content="d3-force의 개념과 동작 방식을 코드와 함께 살펴봅니다."><title>Simulating Physical Forces</title><script async>"serviceWorker"in navigator&&navigator.serviceWorker.register("/js/sw.js")</script><script async type=module src=/js/main.js></script>
<link rel=icon href=https://jinyongp.dev/favicon.ico><link rel=preload href=https://jinyongp.dev/main.min.css as=style><link rel=stylesheet href=https://jinyongp.dev/main.min.css><link rel=preload href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css><script defer type=module>
    import hljs from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/highlight.min.js";
    import dart from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/languages/dart.min.js";
    hljs.configure({})
    hljs.registerLanguage("dart", dart);
    hljs.highlightAll();
    console.log("highlight.js loaded")
  </script><link rel=preload href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap" as=style><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap"><style>:root{--accent:65 105 225;--font:Raleway}</style></head><body><nav class=shadow-md><div class="layout flex justify-between text-gray-600"><ul class="flex gap-4 py-4"><li class=hover:text-accent><a title=Home href=/>Home</a></li><li class=hover:text-accent><a class=text-accent title=Posts href=/posts>Posts</a></li><li class=hover:text-accent><a title=Learn href=/learn>Learn</a></li><li class=hover:text-accent><a title=Series href=/series>Series</a></li></ul><ul class="flex gap-4 py-4"><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-envelope href=mailto:dev.jinyongp@gmail.com target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M64 32C28.7 32 0 60.7.0 96V416c0 35.3 28.7 64 64 64H384c35.3.0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM218 271.7 64.2 172.4C66 156.4 79.5 144 96 144H352c16.5.0 30 12.4 31.8 28.4L230 271.7c-1.8 1.2-3.9 1.8-6 1.8s-4.2-.6-6-1.8zm29.4 26.9L384 210.4V336c0 17.7-14.3 32-32 32H96c-17.7.0-32-14.3-32-32V210.4l136.6 88.2c7 4.5 15.1 6.9 23.4 6.9s16.4-2.4 23.4-6.9z"/></svg></i></a></li><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-velog href=https://velog.io/@jinyongp target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" style="transform:scale(.875)" viewBox="0 0 192 192"><path d="M24 0H168c13.255.0 24 10.7451 24 24V168c0 13.255-10.745 24-24 24H24c-13.2549.0-24-10.745-24-24V24C0 10.7451 10.7451.0 24 0zM49 57.9199V65.48H67l13.6799 77.04L98.5 141.26c17.52-22.2 29.34-38.82 35.46-49.8601C140.2 80.24 143.32 70.9399 143.32 63.5 143.32 59.0601 142 55.7 139.36 53.4199 136.84 51.1399 133.66 50 129.82 50 122.62 50 116.62 53.0601 111.82 59.1799 116.5 62.3 119.68 64.8799 121.36 66.9199c1.8 1.92020000000001 2.7 4.5 2.7 7.74C124.06 80.0601 122.44 86.1799 119.2 93.02 116.08 99.8601 112.66 105.92 108.94 111.2 106.54 114.56 103.48 118.7 99.76 123.62L88.0601 57.2C87.1001 52.3999 84.1001 50 79.0601 50 76.78 50 72.3999 50.96 65.9199 52.8799c-6.48 1.8-12.1199 3.4802-16.9199 5.04z"/></svg></i></a></li><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-rss href=/feed.xml target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M64 32C28.7 32 0 60.7.0 96V416c0 35.3 28.7 64 64 64H384c35.3.0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24 137 0 248 111 248 248 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-2e2-2e2-2e2-13.3.0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24 83.9.0 152 68.1 152 152 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104-13.3.0-24-10.7-24-24zm0 120a32 32 0 1164 0 32 32 0 11-64 0z"/></svg></i></a></li><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-github href=https://github.com/jinyongp/ target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3.0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1.0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6s-28.4 1.9-41.6 5.6c0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7.0 13.9.2 36.5.2 40.6.0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3.0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4.0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6.0-3.7-1.5s-1.1-3.2.0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3.0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"/></svg></i></a></li></ul></div></nav><main><div class=layout><header class=text-center><h1 class="relative mt-16 mb-12 flex justify-center items-center gap-2">Simulating Physical Forces</h1><div class="flex justify-between items-center"><div><a href=https://jinyongp.dev/tags/d3.js><kbd class="text-xs bg-accent text-white rounded px-1 py-0.5">d3.js</kbd></a></div><span>Written on Apr 14, 2022</span></div><hr class="my-4 w-full"></header><div class="text-slate-500 grid grid-cols-1 gap-2 md:gap-20 md:grid-cols-2"><div></div><div><a title="Next Series (Data Driven Transformation of DOM)" href=/posts/d3js/2/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent text-right"><div class="flex items-center gap-1 [&_span]:font-bold justify-end"><span>NEXT</span>
<i class=mb-0.5><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M438.6 278.6c12.5-12.5 12.5-32.8.0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3.0s-12.5 32.8.0 45.3L338.8 224H32c-17.7.0-32 14.3-32 32s14.3 32 32 32h306.7L233.4 393.4c-12.5 12.5-12.5 32.8.0 45.3s32.8 12.5 45.3.0l160-160z"/></svg></i></div><span class="truncate whitespace-nowrap">Data Driven Transformation of DOM</span></a></div></div><hr class=my-4><article class=content><h1 id=introduction class="flex items-center gap-3">Introduction <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Introduction href=#introduction><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h1><p><a class=underline-lsre href=https://github.com/d3/d3-force target=_blank rel="noopener noreferrer nofollow">d3-force</a>는 입자(<code>nodes</code>) 간에 가해지는 물리적 힘(forces)을 simulation하여 입자의 좌표값을 계산하고 제공합니다.</p><p>코드와 함께 <a class=underline-lsre href=#simulation>Simulation</a>과 <a class=underline-lsre href=#forces>Forces</a>에 대해 이해해봅시다.</p><hr><h2 id=simulationhttpsgithubcomd3d3-forcesimulation class="flex items-center gap-3"><a class=underline-lsre href=https://github.com/d3/d3-force#simulation target=_blank rel="noopener noreferrer nofollow">Simulation</a> <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Simulation href=#simulationhttpsgithubcomd3d3-forcesimulation><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>Simulation은 <code>nodes</code>에 가해지는 물리적 힘을 계산합니다. <code>d3.forceSimulation()</code> 함수로 simulation을 생성합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const simulation = d3.forceSimulation();</code></pre></div><p>Simulation에 그래프의 정점 목록인 <code>nodes</code>와 간선 목록인 <code>links</code>를 등록할 수 있습니다.</p><h3 id=nodes class="flex items-center gap-3">Nodes <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Nodes href=#nodes><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>먼저 <code>nodes</code>에 대해 알아봅시다. Simulation은 입력한 <code>node</code> 객체에 계산 결과값을 추가합니다. <code>nodes</code> 배열에서 각 <code>node</code>를 인덱스로 관리해도 되지만, 보기 어려우므로 고유 식별자 <code>id</code>를 추가하겠습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const nodes = [...Array(5)].map((_, i) =&gt; ({ id: i &#43; 1 }));
// [{ id: 1 }, { id: 2 }, { id: 3 }, { id: 4 }, { id: 5 }]

simulation.nodes(nodes);
// nodes [
//   {
//     id: 1,
//     index: 0,
//     vx: x.xx,
//     vy: x.xx,
//     x: x.xx,
//     y: x.xx,
//   }
//   , ...
// ]</code></pre></div><p>Simulation은 <code>node</code>에 <code>index</code>와 함께 좌표값인 <code>x</code>, <code>y</code> 그리고 속도값인 <code>vx</code>, <code>vy</code>를 추가합니다. 원본 <code>node</code> 객체 자체를 수정해야하므로 <a class=underline-lsre href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions target=_blank rel="noopener noreferrer nofollow">non-extensible한 객체</a>는 사용할 수 없습니다. 만약 불변성 유지가 필요하다면 객체를 복사하여 전달해야 합니다.</p><h3 id=links class="flex items-center gap-3">Links <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Links href=#links><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>그럼 이제 <code>links</code>를 등록해봅시다. d3-force에서 <code>link</code> 객체는 방향성을 지닌 간선이므로 <code>source</code>와 <code>target</code>을 가진 객체로 선언합니다. <code>nodes</code>와 달리 각 property는 객체가 아닌 <code>node</code>를 식별할 <code>id</code>를 갖습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const links = [
  { source: 1, target: 4 },
  { source: 3, target: 4 },
  { source: 2, target: 5 },
  { source: 4, target: 1 },
  { source: 5, target: 4 },
];

simulation.force(&#39;link&#39;, d3.forceLink(links).id(({ id }) =&gt; id));
// links [
//   {
//     index: 1,
//     source: {
//       id: 3
//       index: 2
//       vx: x.xx,
//       vy: x.xx,
//       x: x.xx,
//       y: x.xx,
//     },
//     target: {
//       ...
//     },
//   }, ...
// ]</code></pre></div><p>나중에 <a class=underline-lsre href=#forces>Forces</a> 챕터에서 다시 만나겠지만, <code>links</code>는 <code>nodes</code>에 작용할 힘을 제공하므로 <code>force</code>로 추가합니다. <code>links</code>를 simulation에 추가하면 <code>source</code>, <code>target</code>에 설정된 <code>id</code>를 동일한 <code>id</code>를 가진 <code>node</code> 객체로 대체합니다. (코드에 나와 있듯 <a class=underline-lsre href=https://github.com/d3/d3-force#link_id target=_blank rel="noopener noreferrer nofollow">link.id()</a> 함수로 지정해야 합니다.)</p><h3 id=tick class="flex items-center gap-3">Tick <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Tick href=#tick><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>Simulation에 <code>nodes</code>와 <code>links</code>를 등록해봤습니다. <code>tick</code> 이벤트에 핸들러 함수를 등록하여 매 <code>tick</code>마다 실행할 코드를 작성할 수 있습니다. Simulation은 생성 직후 곧바로 실행됩니다. 필요하다면 <a class=underline-lsre href=https://github.com/d3/d3-force#simulation_stop target=_blank rel="noopener noreferrer nofollow"><code>simulation.stop()</code></a> 함수로 정지하거나 <a class=underline-lsre href=https://github.com/d3/d3-force#simulation_restart target=_blank rel="noopener noreferrer nofollow"><code>simulation.restart()</code></a>로 재시작할 수 있습니다.</p><p><code>tick</code> 이벤트 핸들러를 등록하여 <code>node</code>에 저장된 결과값을 확인해봅시다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">simulation.on(&#39;tick&#39;, () =&gt; {
  console.log(nodes[0]);
});
// 첫 번째 tick: {id: 1, index: 0, x: 5.826695986913618, y: -4.292216192303559, vy: -4.292216192303559, …}
// 두 번째 tick: {id: 1, index: 0, x: 4.820993020602418, y: -8.04960224695047, vy: -3.7573860546469113, …}
// 세 번째 tick: {id: 1, index: 0, x: 4.188865598751164, y: -10.465829270778734, vy: -2.4162270238282635, …}
// 네 번째 tick: {id: 1, index: 0, x: 3.823314491169919, y: -11.82585404923582, vy: -1.3600247784570867, …}
// ...</code></pre></div><p>Simulation은 <code>tick</code> 단위마다 좌표값을 계산합니다. 우린 simulation에 의해 <code>tick</code>마다 계산된 절대 좌표값(x, y)를 화면에 그려주기만 하면 됩니다. 그리는 건 나중에 d3-selection과 함께 알아보겠습니다.</p><h3 id=alpha class="flex items-center gap-3">Alpha <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Alpha href=#alpha><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>Simulation을 얼마나 진행할 지 결정하는 <code>alpha</code>, <code>alphaMin</code>, <code>alphaDecay</code>, <code>alphaTarget</code>, <code>velocityDecay</code> 속성에 대해 알아보겠습니다. 문서에 주어진 <code>alpha</code>의 정의는 설명도 부실하고 이해하기 꽤 어려우니 <a class=underline-lsre href=https://github.com/d3/d3-force/blob/main/src/simulation.js target=_blank rel="noopener noreferrer nofollow">구현 코드</a>를 보며 동작 방식을 알아봅시다. 주어진 속성의 초기값은 다음과 같습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">var simulation,
    alpha = 1,
    alphaMin = 0.001,
    alphaDecay = 1 - Math.pow(alphaMin, 1 / 300) // 0.02276277904418933
    alphaTarget = 0,
    velocityDecay = 0.6,
    // ...</code></pre></div><p><code>alpha</code>는 매 <code>tick</code>마다 <code>alpha += (alphaTarget - alpha) * alphaDecay</code>로 계산되어 감소합니다. 또한, 매 <code>tick</code>마다 <code>alpha</code>와 <code>alphaMin</code>를 비교합니다. <code>alpha</code>가 <code>alphaMin</code>보다 작아질 때까지 simulation을 실행합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">simulation.on(&#39;tick&#39;, () =&gt; {
  console.log(simulation.alpha());
  // 001: 0.9772372209558107    = 1 &#43; (0 - 1) * 0.02276277904418933;
  // 002: 0.9549925860214359    = alpha &#43; (alphaTarget - alpha) * alphaDecay
  // ...
  // 300: 0.0009999999999999966 종료: alphaMin(0.001) 미만
});</code></pre></div><p><code>alphaTarget</code>은 <code>alpha</code>의 도달 목표입니다. <code>alpha</code>는 <code>alphaTarget</code>에 도달할 때까지 감소합니다. <code>alphaTarget</code>이 <code>alphaMin</code>보다 크다면 <code>alpha</code>가 <code>alphaMin</code>에 도달할 수 없으므로 simulation은 종료되지 않고 계속 실행됩니다. 나중에 d3-drag를 적용할 때 이용할 수 있습니다.</p><p>아래 코드에서 <code>alphaTarget</code>으로 <code>alpha</code>가 <code>1</code>부터 <code>0.5</code>까지 감소하도록 설정했습니다. 하지만 <code>alpha</code>가 <code>0.6</code> 미만으로 감소했을 때 simulation이 종료되므로 <code>0.5</code>까지 감소할 일은 없습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">simulation.alphaMin(0.6).alphaTarget(0.5);
simulation.on(&#39;tick&#39;, () =&gt; {
  console.log(simulation.alpha());
  // 001: 0.9886186104779053
  // 002: 0.9774962930107179
  // ...
  // 070: 0.5997631157484438 종료: alphaMin(0.6) 미만
});</code></pre></div><p>아래 코드에선 <code>alpha</code>가 <code>0.4</code> 이하로 감소해야만 종료됩니다. 하지만, <code>alphaTarget</code>에 의해 <code>0.4</code>보다 작아질 수 없습니다. 고로, simulation이 종료되지 않습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">simulation.alphaMin(0.4).alphaTarget(0.5);
simulation.on(&#39;tick&#39;, () =&gt; {
  console.log(simulation.alpha());
  // 001: 0.9886186104779053
  // 002: 0.9774962930107179
  // ...
  // 300: 0.5005000000000002
  // 301: 진행 중...
});</code></pre></div><p><code>alphaDecay</code>는 <code>alpha</code>의 감소량입니다. 수가 클수록 <code>alpha</code>는 <code>alphaMin</code>에 빠르게 도달합니다.</p><p><code>velocityDecay</code>는 <code>node.vx</code>, <code>node.vy</code> 값의 감소량입니다. 구현 코드에선 <code>node.x += node.vx *= velocityDecay;</code>로 작성되어 있는데, <code>node.vx *= velocityDecay</code>를 먼저 연산하고 <code>node.x += node.vx</code>를 연산합니다. <code>0</code>으로 설정하면 simulation이 종료될 때까지 속도를 계속 유지합니다.</p><hr><h2 id=forceshttpsgithubcomd3d3-forceforces class="flex items-center gap-3"><a class=underline-lsre href=https://github.com/d3/d3-force#forces target=_blank rel="noopener noreferrer nofollow">Forces</a> <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Forces href=#forceshttpsgithubcomd3d3-forceforces><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>Forces는 simulation에서 <code>node</code>에 적용할 물리적 힘입니다. 척력 혹은 인력을 적용하거나, 일정 거리를 유지하게끔 합니다. 몇가지 모듈을 이용해 force를 적용할 수 있습니다. Links, many-body, centering, collision, positioning에 대해 알아봅시다.</p><h3 id=linkshttpsgithubcomd3d3-forcelinks class="flex items-center gap-3"><a class=underline-lsre href=https://github.com/d3/d3-force#links target=_blank rel="noopener noreferrer nofollow">Links</a> <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Links href=#linkshttpsgithubcomd3d3-forcelinks><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>Link force는 <code>node</code>를 연결하고 일정 거리를 유지하는 힘입니다. 위에서 언급했듯 <code>simulation.force()</code>와 <code>d3.forceLink()</code>로 생성합니다. 이 과정에서 <code>distance</code>와 <code>strength</code>를 이용해 거리와 거리를 유지할 힘을 결정합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const forceLink = d3
  .forceLink(links)
  .id(({ id }) =&gt; id)
  .distance(100)
  .strength(1);

simulation.force(&#39;link&#39;, forceLink);</code></pre></div><p><code>strength</code>는 <code>distance</code>로 설정한 일정 거리를 유지하는 힘입니다. <code>0</code>부터 <code>1</code> 사이를 추천합니다</p><h3 id=many-bodyhttpsgithubcomd3d3-forcemany-body class="flex items-center gap-3"><a class=underline-lsre href=https://github.com/d3/d3-force#many-body target=_blank rel="noopener noreferrer nofollow">Many-Body</a> <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Many-Body href=#many-bodyhttpsgithubcomd3d3-forcemany-body><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>Many Body force는 <code>nodes</code>에 척력 혹은 인력을 적용합니다. <code>simulation.force()</code>와 <code>d3.forceManyBody()</code>로 생성합니다. 이 또한, <code>strength</code>로 적용할 힘을 결정합니다. 전달한 수가 양수라면 인력, 음수라면 척력입니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const forceManyBody = d3
  .forceManyBody()
  .strength(-300);

simulation.force(&#39;manyBody&#39;, forceManyBody);</code></pre></div><p>참고로 많은 예시에서 <code>force('manyBody', forceManyBody)</code>가 아닌 <code>force('charge', forceCharge)</code>로 되어있지만 이름은 전혀 중요하지 않습니다. 단순히 식별자 역할을 수행하므로 다른 force와 구분만 가능하면 됩니다.</p><h3 id=centeringhttpsgithubcomd3d3-forcecentering class="flex items-center gap-3"><a class=underline-lsre href=https://github.com/d3/d3-force#centering target=_blank rel="noopener noreferrer nofollow">Centering</a> <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Centering href=#centeringhttpsgithubcomd3d3-forcecentering><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>Centering force는 <code>nodes</code>의 중심이 지정한 좌표(x, y)에 위치하도록 합니다. <code>simulation.force()</code>와 <code>d3.forceCenter()</code>로 생성합니다. Viewport 상에서 정중앙에 위치해야 할 때 적용합니다. <code>strength</code>를 이용하면 부드러운 움직임이 가능합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const forceCenter = d3
  .forceCenter(width / 2, height / 2)
  .strength(0.1);

simulation.force(&#39;center&#39;, forceCenter);</code></pre></div><p><code>resize</code> 이벤트 혹은 <a class=underline-lsre href=https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver target=_blank rel="noopener noreferrer nofollow">ResizeObserver</a>로 크기 변경을 감지하고 <code>nodes</code>가 항상 중앙에 위치하도록 할 수 있습니다.</p><h3 id=collisionhttpsgithubcomd3d3-forcecollision class="flex items-center gap-3"><a class=underline-lsre href=https://github.com/d3/d3-force#collision target=_blank rel="noopener noreferrer nofollow">Collision</a> <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Collision href=#collisionhttpsgithubcomd3d3-forcecollision><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>Collision force는 <code>nodes</code>가 서로 겹치는 것을 방지하는 힘입니다. <code>simulation.force()</code>와 <code>d3.forceCollide()</code>로 생성합니다. <code>node</code>를 점이 아닌 원으로 취급하여 충돌 여부를 확인하고 <code>radius</code>로 원의 반지름을 결정합니다. <code>strength</code>로 겹칠 때 서로 밀어낼 힘을 결정합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const forceCollide = d3
  .forceCollide()
  .radius(5)
  .strength(0.8);

simulation.force(&#39;collide&#39;, forceCollide);</code></pre></div><h3 id=positioninghttpsgithubcomd3d3-forcepositioning class="flex items-center gap-3"><a class=underline-lsre href=https://github.com/d3/d3-force#positioning target=_blank rel="noopener noreferrer nofollow">Positioning</a> <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Positioning href=#positioninghttpsgithubcomd3d3-forcepositioning><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h3><p>Positioning force는 지정한 좌표(x, y)로 <code>nodes</code>를 밀어내는 힘입니다. <code>simulation.force()</code>와 <code>d3.forceX()</code> 그리고 <code>d3.forceY()</code>로 생성합니다. <code>strength</code>로 밀어내는 힘을 결정합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const forceX = d3.forceX().strength(1);
const forceY = d3.forceY(height / 2);

simulation.force(&#39;x&#39;, forceX).force(&#39;y&#39;, forceY);</code></pre></div><p><code>d3.forceRadial()</code> 함수는 원형을 기준으로 밀어내는 힘을 생성합니다. <code>strength</code>로 밀어내는 힘을 결정합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>javascript</small><pre><code class="hljs language-javascript">const forceRadial = d3
  .forceRadial(100, width / 2, height / 2)
  .strength(0.5);

simulation.force(&#39;radial&#39;, forceRadial);</code></pre></div><hr><h2 id=conclusion class="flex items-center gap-3">Conclusion <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=Conclusion href=#conclusion><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>d3-force의 개념과 동작 방식을 코드와 함께 살펴보았습니다. d3-force의 simulation, tick을 조절할 수 있는 alpha 그리고 force의 종류에 대해서 알아봤습니다. 처음 볼 땐 어려워보일 수 있겠지만 알아야 할 개념이 그리 많지 않고 이해하기 쉬운 코드와 패턴으로 금방 익힐 수 있었습니다.</p><p>아직 d3-selection를 다루지 않아 계산 결과값으로 그래프를 그려보진 않았습니다만, 다음 시간에 d3-selection을 학습하면서 SVG로 그래프를 그려보고 이후 d3-zoom과 d3-drag를 적용해보도록 하겠습니다.</p><hr><h2 id=references class="flex items-center gap-3">References <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=References href=#references><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><ul><li><a class=underline-lsre href=https://github.com/d3/d3-force target=_blank rel="noopener noreferrer nofollow">d3-force</a></li><li><a class=underline-lsre href=https://stackoverflow.com/q/46426072/9735184 target=_blank rel="noopener noreferrer nofollow">What is the difference between alphaTarget and alphaMin?</a></li></ul></article><script src=https://giscus.app/client.js data-repo=jinyongp/jinyongp.dev data-repo-id=R_kgDOHJDtcg data-category=Comments data-category-id=DIC_kwDOHJDtcs4CXf7o data-mapping=title data-strict=0 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=ko crossorigin=anonymous async></script><div class=h-24></div></div></main><footer class="absolute bottom-0 w-full"><div class="flex justify-center py-8"><p class="[&_a]:text-accent text-center text-sm">Copyright 2023. Jinyong Park. All rights reserved.<br><span class=text-xs>Powered by
<a title="Go to Hugo Site" href=https://gohugo.io target=_blank rel="noopener noreferrer nofollow">Hugo</a>
| Developed on
<a title="Go to Github Repo" href=https://github.com/jinyongp/jinyongp.github.io target=_blank rel="noopener noreferrer nofollow">Here</a></span></p></div></footer><div id=js-scroll-back-to-top class="back-to-top hide"><i class=text-accent><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><path d="M288 0c17.7.0 32 14.3 32 32V49.7C451.8 63.4 557.7 161 573.9 285.9c2 15.6-17.3 24.4-27.8 12.7C532.1 283 504.8 272 480 272c-38.7.0-71 27.5-78.4 64.1-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C359 299.5 326.7 272 288 272s-71 27.5-78.4 64.1c-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C167 299.5 134.7 272 96 272c-24.8.0-52.1 11-66.1 26.7C19.4 310.4.1 301.5 2.1 285.9 18.3 161 124.2 63.4 256 49.7V32c0-17.7 14.3-32 32-32zm0 304c12.3.0 23.5 4.6 32 12.2V430.6c0 45-36.5 81.4-81.4 81.4-30.8.0-59-17.4-72.8-45l-2.3-4.7c-7.9-15.8-1.5-35 14.3-42.9s35-1.5 42.9 14.3l2.3 4.7c3 5.9 9 9.6 15.6 9.6 9.6.0 17.4-7.8 17.4-17.4V316.2c8.5-7.6 19.7-12.2 32-12.2z"/></svg></i></div></body></html>