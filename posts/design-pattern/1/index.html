<!doctype html><html lang=ko><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0YPW4E1C"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SH0YPW4E1C")</script><meta charset=utf-8><meta name=viewport viewport-fit=cover content="width=device-width"><meta name=HandheldFriendly content="true"><meta name=robots content="index,follow"><link rel=sitemap type=application/xml href=/sitemap.xml><link rel=canonical href=https://jinyongp.dev/posts/design-pattern/1/><meta name=naver-site-verification content="c36f259891f25bc92e3884c1ceb626a0aaa76146"><link rel=alternate type=application/rss+xml href=https://jinyongp.dev/feed.xml title=jinyongp.dev><meta name=author content="jinyongp <dev.jinyongp@gmail.com>"><meta name=keywords content="design-pattern"><link rel=manifest href=/manifest.webmanifest><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="jinyongp.dev"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta name=theme-color content="rgb(65, 105, 225)"><meta property="og:site_name" content="jinyongp.dev"><meta property="og:title" content="Iterator Pattern in Swift"><meta property="og:type" content="website"><meta property="og:url" content="https://jinyongp.dev/posts/design-pattern/1/"><meta property="og:description" content="Iterator Pattern에 대해 알아보고 Swift로 구현해봅니다."><meta name=description content="Iterator Pattern에 대해 알아보고 Swift로 구현해봅니다."><title>Iterator Pattern in Swift</title><link rel=preload href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css><script defer type=module>
    import hljs from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/highlight.min.js";
    import dart from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/languages/dart.min.js";
    hljs.configure({})
    hljs.registerLanguage("dart", dart);
    hljs.highlightAll();
  </script><script async>"serviceWorker"in navigator&&navigator.serviceWorker.register("/js/sw.js")</script><script async type=module src=/js/main.js></script>
<link rel=icon href=https://jinyongp.dev/favicon.ico><link rel=preload href=https://jinyongp.dev/main.min.css as=style><link rel=stylesheet href=https://jinyongp.dev/main.min.css><link rel=preload href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap" as=style><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap"><style>:root{--accent:65 105 225;--font:Raleway}</style></head><body><nav class=shadow-md><div class="layout flex justify-between text-gray-600"><ul class="flex gap-4 py-4"><li class=hover:text-accent><a title=Home href=/>Home</a></li><li class=hover:text-accent><a class=text-accent title=Posts href=/posts>Posts</a></li><li class=hover:text-accent><a title=Learn href=/learn>Learn</a></li><li class=hover:text-accent><a title=Series href=/series>Series</a></li></ul><ul class="flex gap-4 py-4"><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-envelope href=mailto:dev.jinyongp@gmail.com target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M64 32C28.7 32 0 60.7.0 96V416c0 35.3 28.7 64 64 64H384c35.3.0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM218 271.7 64.2 172.4C66 156.4 79.5 144 96 144H352c16.5.0 30 12.4 31.8 28.4L230 271.7c-1.8 1.2-3.9 1.8-6 1.8s-4.2-.6-6-1.8zm29.4 26.9L384 210.4V336c0 17.7-14.3 32-32 32H96c-17.7.0-32-14.3-32-32V210.4l136.6 88.2c7 4.5 15.1 6.9 23.4 6.9s16.4-2.4 23.4-6.9z"/></svg></i></a></li><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-velog href=https://velog.io/@jinyongp target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" style="transform:scale(.875)" viewBox="0 0 192 192"><path d="M24 0H168c13.255.0 24 10.7451 24 24V168c0 13.255-10.745 24-24 24H24c-13.2549.0-24-10.745-24-24V24C0 10.7451 10.7451.0 24 0zM49 57.9199V65.48H67l13.6799 77.04L98.5 141.26c17.52-22.2 29.34-38.82 35.46-49.8601C140.2 80.24 143.32 70.9399 143.32 63.5 143.32 59.0601 142 55.7 139.36 53.4199 136.84 51.1399 133.66 50 129.82 50 122.62 50 116.62 53.0601 111.82 59.1799 116.5 62.3 119.68 64.8799 121.36 66.9199c1.8 1.92020000000001 2.7 4.5 2.7 7.74C124.06 80.0601 122.44 86.1799 119.2 93.02 116.08 99.8601 112.66 105.92 108.94 111.2 106.54 114.56 103.48 118.7 99.76 123.62L88.0601 57.2C87.1001 52.3999 84.1001 50 79.0601 50 76.78 50 72.3999 50.96 65.9199 52.8799c-6.48 1.8-12.1199 3.4802-16.9199 5.04z"/></svg></i></a></li><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-github href=https://github.com/jinyongp/ target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3.0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1.0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6s-28.4 1.9-41.6 5.6c0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7.0 13.9.2 36.5.2 40.6.0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3.0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4.0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6.0-3.7-1.5s-1.1-3.2.0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3.0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"/></svg></i></a></li></ul></div></nav><main><div class=layout><header class=text-center><h1 class="relative mt-16 mb-12 flex justify-center items-center gap-2">Iterator Pattern in Swift</h1><div class="flex justify-between items-center"><div><a href=https://jinyongp.dev/tags/design-pattern><kbd class="text-xs bg-accent text-white rounded px-1 py-0.5">design-pattern</kbd></a></div><span>Written on Aug 9, 2023</span></div><hr class="my-4 w-full"></header><div class="text-slate-500 grid grid-cols-1 gap-2 md:gap-20 md:grid-cols-2"><div></div><div><a title="Next Series (Adapter Pattern in Swift)" href=/posts/design-pattern/2/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent text-right"><div class="flex items-center gap-1 [&_span]:font-bold justify-end"><span>NEXT</span>
<i class=mb-0.5><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M438.6 278.6c12.5-12.5 12.5-32.8.0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3.0s-12.5 32.8.0 45.3L338.8 224H32c-17.7.0-32 14.3-32 32s14.3 32 32 32h306.7L233.4 393.4c-12.5 12.5-12.5 32.8.0 45.3s32.8 12.5 45.3.0l160-160z"/></svg></i></div><span class="truncate whitespace-nowrap">Adapter Pattern in Swift</span></a></div></div><hr class=my-4><article class=content><p><strong>Iterator Pattern</strong>은 순회 로직을 순회자(Iterator) 객체로 분리합니다. 이러한 추상화 작업을 통해 순회 불가능한 객체더라도 인터페이스만 구현한다면 순회 가능한 객체로 만들 수 있습니다.</p><blockquote><p><code>Iterator Pattern</code>은 GoF의 분류 체계에서 행위(Behavioral) 패턴에 속합니다.</p></blockquote><p>예를 들어, 자료구조 중 배열은 메모리 구조의 특징 덕분에 0..&lt;배열크기 범위로 인덱스를 증가시키며 요소에 접근할 수 있습니다. 허나 리스트의 경우엔 순회 로직을 직접 구현하지 않는 한 인덱스를 이용한 순회가 불가능합니다. 리스트 클래스를 순회 가능한 객체로 만들기 위해선 별도의 구현을 추가해야 합니다. 여기서 Iterator Pattern을 적용한다면 리스트 클래스의 세부 구현을 변경하지 않고도 순회 가능한 객체로 확장할 수 있습니다.</p><p>Iterator Pattern을 구현하기 위해 필요한 역할은 다음과 같습니다.</p><ul><li>Iterator(반복자): 순회 로직을 추상화한 인터페이스입니다. 다음 요소를 반환하는 <code>next()</code> 메서드와 현재 요소가 마지막 요소인지 확인하는 <code>hasNext()</code> 메서드를 포함합니다.</li><li>ConcreteIterator(구체적인 반복자): Iterator 인터페이스를 구현한 객체입니다.</li><li>Aggregate(집합체): 순회 가능한 객체임을 나타내는 인터페이스입니다. ConcreteIterator 객체를 생성하여 반환하는 <code>makeIterator()</code> 메서드를 포함하기도 합니다. (aka. Iterable)</li><li>ConcreteAggregate(구체적인 집합체): Aggregate 인터페이스를 구현한 객체입니다.</li></ul><p><a class=underline-lsre href=https://product.kyobobook.co.kr/detail/S000200311846 target=_blank rel="noopener noreferrer nofollow">Java 언어로 배우는 디자인 패턴 입문</a>의 Iterator Pattern 예제를 Swift로 작성해보았습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>swift</small><pre><code class="hljs language-swift">protocol Iterable&lt;Element&gt; {
    associatedtype Element where Element == Iter.Element
    associatedtype Iter: Iterator

    func makeIterator() -&gt; Iter;
}

protocol Iterator&lt;Element&gt; {
    associatedtype Element

    mutating func next() -&gt; Element?
}

struct Book {
    private(set) var name: String
}

struct BookShelf {
    private var books: [Book] = []
    var count: Int { books.count }

    func book(at index: Int) -&gt; Book {
        return books[index]
    }

    mutating func add(book: Book) {
        books.append(book)        
    }
}

extension BookShelf: Iterable {
    typealias Element = Book
    typealias Iter = BookShelfIterator

    func makeIterator() -&gt; Iter {
        return BookShelfIterator(self)
    }
}

struct BookShelfIterator: Iterator {
    typealias Element = Book

    private let bookShelf: BookShelf
    private var index: Int

    init(_ bookShelf: BookShelf) {
        self.bookShelf = bookShelf
        index = 0
    }

    mutating func next() -&gt; Element? {
        if bookShelf.count &gt; index {
            defer { index &#43;= 1 }
            return bookShelf.book(at: index)
        }
        return nil
    }
}

var bookShelf = BookShelf()
bookShelf.add(book: Book(name: &#34;Book1&#34;))
bookShelf.add(book: Book(name: &#34;Book2&#34;))
bookShelf.add(book: Book(name: &#34;Book3&#34;))
bookShelf.add(book: Book(name: &#34;Book4&#34;))

var iterator = bookShelf.makeIterator()

while let book = iterator.next() {
    print(book.name)
}

// output:
// Book1
// Book2
// Book3
// Book4</code></pre></div><blockquote><p>Swift에서는 <code>nil</code> 값을 제공하므로 <code>hasNext()</code> 메서드 대신 <code>next()</code> 메서드가 <code>nil</code>을 반환하면 순회를 종료하도록 구현합니다.</p></blockquote><p>코드에 따르면 각 구조체는 다음 역할을 따릅니다.</p><ul><li><code>Iterator</code>: Iterator</li><li><code>BookShelfIterator</code>: ConcreteIterator</li><li><code>Iterable</code>: Aggregate</li><li><code>BookShelf</code>: ConcreteAggregate</li></ul><p>이렇게 순회를 담당하는 로직을 별도의 클래스로 분리하여 확장성을 높이는 것이 Iterator Pattern의 핵심입니다. 인터페이스를 활용한 이러한 확장성 및 다형성 덕분에 <code>Iterator</code> 인터페이스만 구현하고 있으면 모든 순회가 필요한 로직에 적용할 수 있습니다.</p><hr><p>이미 Swift에서는 <a class=underline-lsre href=https://developer.apple.com/documentation/swift/iteratorprotocol target=_blank rel="noopener noreferrer nofollow">IteratorProtocol</a> 프로토콜을 제공하여 어떠한 클래스든 <code>IteratorProtocol</code>을 채택하여 <code>for in</code> 구문에 활용할 수 있습니다. (Aggregate 역할을 <code>Sequence</code> 프로토콜이 수행합니다.)</p><p>Apple 공식 문서의 예제를 가져왔습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>swift</small><pre><code class="hljs language-swift">struct Countdown: Sequence {
    let start: Int

    func makeIterator() -&gt; CountdownIterator {
        return CountdownIterator(self)
    }
}

struct CountdownIterator: IteratorProtocol {
    let countdown: Countdown
    var times = 0

    init(_ countdown: Countdown) {
        self.countdown = countdown
    }

    mutating func next() -&gt; Int? {
        let nextNumber = countdown.start - times
        guard nextNumber &gt; 0 else { return nil }

        times &#43;= 1
        return nextNumber
    }
}

let countdown3 = Countdown(start: 3)
for count in countdown3 {
    print(&#34;\(count)...&#34;)
}

// output:
// 3..
// 2..
// 1..</code></pre></div><p><code>Countdown</code>은 ConcreteAggregate 역할을 수행하며, <code>CountdownIterator</code>는 ConcreteIterator 역할을 수행합니다. 이렇게 순회 로직을 분리하는 방식으로 Collection 형식이 아니라 하더라도 순회 로직을 추가함으로서 순회 가능한 객체를 만들 수 있습니다.</p><h2 id=references class="flex items-center gap-3">References <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title=References href=#references><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><ul><li><a class=underline-lsre href=https://refactoring.guru/design-patterns/iterator target=_blank rel="noopener noreferrer nofollow">Iterator Pattern : Refactoring Guru</a></li><li><a class=underline-lsre href=https://developer.apple.com/documentation/swift/iteratorprotocol target=_blank rel="noopener noreferrer nofollow">IteratorProtocol : Apple</a></li></ul></article><script src=https://giscus.app/client.js data-repo=jinyongp/jinyongp.dev data-repo-id=R_kgDOHJDtcg data-category=Comments data-category-id=DIC_kwDOHJDtcs4CXf7o data-mapping=title data-strict=0 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=ko crossorigin=anonymous async></script><div class=h-24></div></div></main><footer class="absolute bottom-0 w-full"><div class="flex justify-center py-8"><p class="[&_a]:text-accent text-center text-sm">Copyright 2023. Jinyong Park. All rights reserved.<br><span class=text-xs>Powered by
<a title="Go to Hugo Site" href=https://gohugo.io target=_blank rel="noopener noreferrer nofollow">Hugo</a>
| Developed on
<a title="Go to Github Repo" href=https://github.com/jinyongp/jinyongp.github.io target=_blank rel="noopener noreferrer nofollow">Here</a></span></p></div></footer><div id=js-scroll-back-to-top class="back-to-top hide"><i class=text-accent><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><path d="M288 0c17.7.0 32 14.3 32 32V49.7C451.8 63.4 557.7 161 573.9 285.9c2 15.6-17.3 24.4-27.8 12.7C532.1 283 504.8 272 480 272c-38.7.0-71 27.5-78.4 64.1-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C359 299.5 326.7 272 288 272s-71 27.5-78.4 64.1c-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C167 299.5 134.7 272 96 272c-24.8.0-52.1 11-66.1 26.7C19.4 310.4.1 301.5 2.1 285.9 18.3 161 124.2 63.4 256 49.7V32c0-17.7 14.3-32 32-32zm0 304c12.3.0 23.5 4.6 32 12.2V430.6c0 45-36.5 81.4-81.4 81.4-30.8.0-59-17.4-72.8-45l-2.3-4.7c-7.9-15.8-1.5-35 14.3-42.9s35-1.5 42.9 14.3l2.3 4.7c3 5.9 9 9.6 15.6 9.6 9.6.0 17.4-7.8 17.4-17.4V316.2c8.5-7.6 19.7-12.2 32-12.2z"/></svg></i></div></body></html>