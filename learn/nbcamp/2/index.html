<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=HandheldFriendly content="true"><link rel=canonical href=https://jinyongp.dev><meta name=naver-site-verification content="c36f259891f25bc92e3884c1ceb626a0aaa76146"><link rel=alternate type=application/rss+xml href=https://jinyongp.dev/feed.xml title=jinyongp.dev><meta name=author content="jinyongp <dev.jinyongp@gmail.com>"><meta name=keywords content="nbcamp,flutter"><link rel=manifest href=/manifest.webmanifest><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="jinyongp.dev"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta property="og:site_name" content="jinyongp.dev"><meta property="og:title" content="[내배캠] 첫번째 팀 프로젝트"><meta property="og:type" content="website"><meta property="og:url" content="https://jinyongp.dev/learn/nbcamp/2/"><meta property="og:description" content="사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다."><meta name=description content="사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다."><title>[내배캠] 첫번째 팀 프로젝트</title><link rel=icon href=https://jinyongp.dev/favicon.png><link rel=stylesheet href=https://jinyongp.dev/main.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><style>:root{--accent:65 105 225;--font:Raleway}</style><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/nord.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script>
<script async>hljs.highlightAll(),hljs.configure({ignoreUnescapedHTML:!0})</script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PFTW4CN")</script><script async>"serviceWorker"in navigator&&navigator.serviceWorker.register("/js/sw.js")</script><script async src=/js/main.js></script></head><body><nav class=shadow-md><div class="layout flex justify-between text-gray-600"><ul class="flex gap-4 py-4"><li class=hover:text-accent><a href=/>Home</a></li><li class=hover:text-accent><a href=/posts>Posts</a></li><li class=hover:text-accent><a href=/learn class=text-accent>Learn</a></li><li class=hover:text-accent><a href=/series>Series</a></li></ul><ul class="flex gap-4 py-4"><li class="hover:text-accent grid place-items-center"><a class=text-xl href=mailto:dev.jinyongp@gmail.com target=_blank rel="noopener noreferrer"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M64 112c-8.8.0-16 7.2-16 16v22.1L220.5 291.7c20.7 17 50.4 17 71.1.0L464 150.1V128c0-8.8-7.2-16-16-16H64zM48 212.2V384c0 8.8 7.2 16 16 16H448c8.8.0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64H448c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3.0-64-28.7-64-64V128z"/></svg></i></a></li><li class="hover:text-accent grid place-items-center"><a class=text-xl href=https://github.com/jinyongp/ target=_blank rel="noopener noreferrer"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></i></a></li></ul></div></nav><main><div class=layout><header class="relative text-center flex flex-col items-stretch justify-center"><a href=https://github.com/nbcamp/introduce-e1if class="absolute -translate-y-12 md:-translate-y-14 self-center flex items-center gap-1 text-sm md:text-base hover:text-accent" target=_blank rel="noopener noreferrer nofollow"><i class=md:text-lg><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8.0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8.0-21.5 4.9-32.3 14.6-51.8 45.3.0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8.0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9.0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2.0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8.0-73.5 38.7-73.5 82.6.0 87.8 80.4 101.3 150.4 101.3h48.2c70.3.0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8.0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg></i></a><h1 class="mt-16 mb-12">[내배캠] 첫번째 팀 프로젝트</h1><div class="flex justify-between items-center"><div><a href=https://jinyongp.dev/tags/nbcamp><kbd class="text-xs bg-accent text-white rounded px-1 py-0.5">nbcamp</kbd></a>
<a href=https://jinyongp.dev/tags/flutter><kbd class="text-xs bg-accent text-white rounded px-1 py-0.5">flutter</kbd></a></div><h6>Written on Jul 19, 2023</h6></div><hr class="my-4 w-full"></header><article class="content [&_hr]:my-4"><p>사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다.</p><p>4일간 진행한 프로젝트로 목적은 앱 개발 전반의 과정을 익히기 위함이지만, 보다 팀원분들과의 소통과 협업 관점에 비중으로 두고 프로젝트를 진행하였습니다.</p><p>프로젝트의 주제는 팀과 팀원의 소개를 담은 앱을 작성하는 것으로, 각자 자신의 소개를 담은 상세 페이지를 작성하고 합치기로 결정하였습니다.
저는 상세 페이지와 더불어 메인 페이지와 각 상세 페이지에서 쓰일 댓글 관리 서비스를 맡았습니다.</p><p>그 중에서도 댓글 관리 서비스를 어떻게 구현했는지 정리해보고자 합니다.</p><p><a class=underline-lsre href=https://github.com/nbcamp/introduce-e1if target=_blank rel="noopener noreferrer nofollow">프로젝트 저장소</a></p><h2 id=의존성-주입을-위해-인터페이스-적용하기>의존성 주입을 위해 인터페이스 적용하기</h2><p>사전캠프에서도 다뤘지만, Service 단에서 <code>shared_preferences</code>를 사용하기 위해 서비스 파일 내에서 직접 불러와서 사용해주는 방식이 아니라 <code>main.dart</code>에서 <code>save</code>와 <code>load</code> 함수를 주입해주는 방식으로 구현했었습니다.</p><p>허나, 아래처럼 <code>save</code> 혹은 <code>load</code> 둘 다 구현해야하는 걸 강제할 수 없었습니다. 또한, <code>shared_preferences</code>외에 다른 걸로 변경할 때도 번거롭습니다</p><pre><code class=language-ts>void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  SharedPreferences pref await SharedPreferences.getInstance();
  runApp(MultiProvider(
    providers: [
      ChangeNotifierProvider(
        create: (_) =&gt; MemoService(
          save: (String payload) async =&gt; await pref.setString(&quot;memo&quot;, payload),
          // load: () async =&gt; pref.getString(&quot;memo&quot;), // 에러를 발생시키지 않음
        ),
      ),
    ],
    child: const MyApp(),
  ));
}
</code></pre><p>이를 해결하기 위해 <code>IO</code> 인터페이스를 구현했습니다.</p><pre><code class=language-ts>abstract class IO {
  Future&lt;void&gt; save(String payload);
  Future&lt;String?&gt; load();
}
</code></pre><p>dart에서는 인터페이스를 생성하기 위해 <code>abstract class</code> 키워드를 사용해야 합니다. <code>IO</code> 인터페이스는 <code>save</code>와 <code>load</code> 함수에 대한 명세를 제공합니다. 이를 <code>CommentService</code>에 적용합니다.</p><pre><code class=language-ts>class CommentService extends ChangeNotifier {
  final Map&lt;String, List&lt;Comment&gt;&gt; _comments = {};

  IO? io;

  CommentService({this.io}) {
    //
  }

  ...
}
</code></pre><p>이제 <code>io</code> 인스턴스를 외부에서 주입해줄 수 있습니다. <code>shared_preferences</code>를 사용할 예정이므로 <code>SharedPreferencesIO</code> 클래스를 생성합니다.</p><pre><code class=language-tsx>class SharedPreferencesIO implements IO {
  late Future&lt;SharedPreferences&gt; pref;

  SharedPreferencesIO() {
    pref = SharedPreferences.getInstance();
  }

  @override
  Future&lt;String?&gt; load() {
    return pref.then((pref) =&gt; pref.getString('comments'));
  }

  @override
  Future&lt;void&gt; save(String payload) async {
    pref.then((pref) =&gt; pref.setString('comments', payload));
  }
}
</code></pre><pre><code class=language-ts>void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  runApp(MultiProvider(
    providers: [
      ChangeNotifierProvider(
        create: (_) =&gt; CommentService(
          io: SharedPreferencesIO(),
        ),
      ),
    ],
    child: MainApp(),
  ));
}
</code></pre><p>구현한 <code>SharedPreferencesIO</code> 클래스를 <code>main.dart</code>에서 <code>CommentService</code>에 주입해줍니다.</p><p>이로써, <code>save</code>와 <code>load</code> 모두 구현해야 함을 강제할 수 있게 되었고, <code>IO</code> 인터페이스를 상속하는 클래스를 여러 개 추가하여 상황에 따라 교체할 수 있어 확장성을 높였습니다.</p><h2 id=데이터-송수신-로직-추상화하기>데이터 송수신 로직 추상화하기</h2><p><code>CommentService</code>에서 내부적으로 데이터를 저장하고 불러오는 <code>_save</code>와 <code>_load</code> 함수가 있었습니다.</p><pre><code class=language-ts>Future&lt;void&gt; _save() {
  if (save == null) return Future.value();

  String payload = jsonEncode(_memos.map((m) =&gt; m.toJson()).toList());
  return save!(payload);
}

Future&lt;void&gt; _load() async {
  if (load == null) return;

  String? payload = await load!();
  if (payload == null) return;
  _memos.clear();

  _memos.addAll(jsonDecode(payload).map((e) =&gt; Memo.fromJson(e)));
}
</code></pre><p>여기서 데이터를 String 타입의 payload로 만들거나, 반대로 payload를 데이터로 변환하는 작업을 수행했었습니다.
언뜻보면 null 체크를 하고 종료하는 부분이나 payload를 처리하는 부분은 중복된 부분이기에 별도의 함수로 분리하고 싶었습니다.</p><p>그래서 <code>DataHandler</code> 추상 클래스르 작성하였습니다.</p><pre><code class=language-ts>mixin DataHandler {
  IO? io;

  Future&lt;void&gt; import(String payload);
  Future&lt;String&gt; export();

  Future&lt;void&gt; save() async {
    if (io == null) return Future.value();
    var payload = await export();
    io?.save(payload);
  }

  Future&lt;void&gt; load() async {
    if (io == null) return Future.value();
    var payload = await io!.load();
    if (payload == null) return;
    import(payload);
  }
}
</code></pre><p>dart에서 mixin을 활용하여 추상 클래스를 작성할 수 있습니다.
<code>save</code>와 <code>load</code> 함수는 이미 구현되어 있어 동일한 작업을 수행하지만, <code>import</code>와 <code>export</code> 함수는 재정의가 필요합니다. 이를 <code>CommentService</code>에 적용합니다.</p><pre><code class=language-ts>class UseState {
  final List&lt;Comment&gt; comments;
  final void Function(List&lt;Comment&gt; Function()) setState;

  UseState({
    required this.comments,
    required this.setState,
  });
}

class CommentService extends ChangeNotifier with DataHandler {
  final Map&lt;String, List&lt;Comment&gt;&gt; _comments = {};

  CommentService({IO? io}) {
    this.io = io;

    try {
      load().then((_) =&gt; notifyListeners());
    } catch (error) {
      // ignore
    }
  }

  UseState useState(String name) {
    return UseState(
      comments: List.unmodifiable(_comments[name] ?? []),
      setState: (newComments) {
        _comments[name] = newComments();
        notifyListeners();
        save();
      },
    );
  }

  @override
  Future&lt;void&gt; import(String payload) async {
    jsonDecode(payload).forEach((key, values) {
      if (values is! List) return;
      _comments[key] = values.map((value) =&gt; Comment.fromJson(value)).toList();
    });
  }

  @override
  Future&lt;String&gt; export() async {
    return jsonEncode(
      _comments.map(
        (key, values) =&gt; MapEntry(
          key,
          values.map((comment) =&gt; comment.toJson()).toList(),
        ),
      ),
    );
  }
}
</code></pre><p><code>mixin</code>을 상속하기 위해선 <code>with</code> 키워드를 사용해야 합니다. <code>DataHandler</code>를 상속하면서 <code>CommentService</code>에서 구현해야 하는 함수들을 재정의합니다.
<code>import</code>와 <code>export</code> 함수는 단순히 JSON 형태의 stringify와 parse 작업을 수행합니다. 이로써 상속을 통해 중복 코드를 제거하고 함수의 역할을 분리할 수 있었습니다.</p></article><script src=https://giscus.app/client.js data-repo=jinyongp/jinyongp.dev data-repo-id=R_kgDOHJDtcg data-category=Comments data-category-id=DIC_kwDOHJDtcs4CXf7o data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=ko crossorigin=anonymous async></script><div class=h-24></div></div></main><footer class="absolute bottom-0 w-full"><div class="flex justify-center py-8"><p class="[&_a]:text-accent text-center text-sm">Copyright 2023. Jinyong Park. All rights reserved.<br><span class=text-xs>Powered by <a class=underline-lsre href=https://gohugo.io target=_blank rel="noopener noreferrer nofollow">Hugo</a>
.</span></p></div></footer><div id=js-scroll-back-to-top class="back-to-top hide fixed bottom-10 right-10 rounded-full w-10 h-10 bg-white border border-accent grid place-items-center cursor-pointer"><i class=text-accent><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><path d="M288 0c17.7.0 32 14.3 32 32V49.7C451.8 63.4 557.7 161 573.9 285.9c2 15.6-17.3 24.4-27.8 12.7C532.1 283 504.8 272 480 272c-38.7.0-71 27.5-78.4 64.1-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C359 299.5 326.7 272 288 272s-71 27.5-78.4 64.1c-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C167 299.5 134.7 272 96 272c-24.8.0-52.1 11-66.1 26.7C19.4 310.4.1 301.5 2.1 285.9 18.3 161 124.2 63.4 256 49.7V32c0-17.7 14.3-32 32-32zm0 304c12.3.0 23.5 4.6 32 12.2V430.6c0 45-36.5 81.4-81.4 81.4-30.8.0-59-17.4-72.8-45l-2.3-4.7c-7.9-15.8-1.5-35 14.3-42.9s35-1.5 42.9 14.3l2.3 4.7c3 5.9 9 9.6 15.6 9.6 9.6.0 17.4-7.8 17.4-17.4V316.2c8.5-7.6 19.7-12.2 32-12.2z"/></svg></i></div></body></html>