<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport viewport-fit=cover content="width=device-width"><meta name=HandheldFriendly content="true"><meta name=robots content="index,follow"><link rel=sitemap type=application/xml href=/sitemap.xml><link rel=canonical href=https://jinyongp.dev/learn/nbcamp/2/><meta name=naver-site-verification content="c36f259891f25bc92e3884c1ceb626a0aaa76146"><link rel=alternate type=application/rss+xml href=https://jinyongp.dev/feed.xml title=jinyongp.dev><meta name=author content="jinyongp <dev.jinyongp@gmail.com>"><meta name=keywords content="iOS,내배캠,내일배움캠프,스파르타코딩클럽,nbcamp,flutter"><link rel=manifest href=/manifest.webmanifest><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="jinyongp.dev"><meta name=apple-mobile-web-app-status-bar-style content="default"><meta name=theme-color content="rgb(65, 105, 225)"><meta property="og:site_name" content="jinyongp.dev"><meta property="og:title" content="[내배캠] 첫번째 팀 프로젝트"><meta property="og:type" content="website"><meta property="og:url" content="https://jinyongp.dev/learn/nbcamp/2/"><meta property="og:description" content="사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다."><meta name=description content="사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다."><title>[내배캠] 첫번째 팀 프로젝트</title><link rel=preload href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.8.0/build/styles/nord.min.css><script defer type=module>
    import hljs from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/highlight.min.js";
    import dart from "https:\/\/cdn.jsdelivr.net\/gh\/highlightjs\/cdn-release@11.8.0\/build/es/languages/dart.min.js";
    hljs.configure({})
    hljs.registerLanguage("dart", dart);
    hljs.highlightAll();
  </script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PFTW4CN")</script><script async>"serviceWorker"in navigator&&navigator.serviceWorker.register("/js/sw.js")</script><script async type=module src=/js/main.js></script>
<link rel=icon href=https://jinyongp.dev/favicon.ico><link rel=preload href=https://jinyongp.dev/main.min.css as=style><link rel=stylesheet href=https://jinyongp.dev/main.min.css><link rel=preload href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap" as=style><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway&amp;display=swap"><style>:root{--accent:65 105 225;--font:Raleway}</style></head><body><nav class=shadow-md><div class="layout flex justify-between text-gray-600"><ul class="flex gap-4 py-4"><li class=hover:text-accent><a title=Home href=/>Home</a></li><li class=hover:text-accent><a title=Posts href=/posts>Posts</a></li><li class=hover:text-accent><a class=text-accent title=Learn href=/learn>Learn</a></li><li class=hover:text-accent><a title=Series href=/series>Series</a></li></ul><ul class="flex gap-4 py-4"><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-envelope href=mailto:dev.jinyongp@gmail.com target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M64 32C28.7 32 0 60.7.0 96V416c0 35.3 28.7 64 64 64H384c35.3.0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM218 271.7 64.2 172.4C66 156.4 79.5 144 96 144H352c16.5.0 30 12.4 31.8 28.4L230 271.7c-1.8 1.2-3.9 1.8-6 1.8s-4.2-.6-6-1.8zm29.4 26.9L384 210.4V336c0 17.7-14.3 32-32 32H96c-17.7.0-32-14.3-32-32V210.4l136.6 88.2c7 4.5 15.1 6.9 23.4 6.9s16.4-2.4 23.4-6.9z"/></svg></i></a></li><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-velog href=https://velog.io/@jinyongp target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" style="transform:scale(.875)" viewBox="0 0 192 192"><path d="M24 0H168c13.255.0 24 10.7451 24 24V168c0 13.255-10.745 24-24 24H24c-13.2549.0-24-10.745-24-24V24C0 10.7451 10.7451.0 24 0zM49 57.9199V65.48H67l13.6799 77.04L98.5 141.26c17.52-22.2 29.34-38.82 35.46-49.8601C140.2 80.24 143.32 70.9399 143.32 63.5 143.32 59.0601 142 55.7 139.36 53.4199 136.84 51.1399 133.66 50 129.82 50 122.62 50 116.62 53.0601 111.82 59.1799 116.5 62.3 119.68 64.8799 121.36 66.9199c1.8 1.92020000000001 2.7 4.5 2.7 7.74C124.06 80.0601 122.44 86.1799 119.2 93.02 116.08 99.8601 112.66 105.92 108.94 111.2 106.54 114.56 103.48 118.7 99.76 123.62L88.0601 57.2C87.1001 52.3999 84.1001 50 79.0601 50 76.78 50 72.3999 50.96 65.9199 52.8799c-6.48 1.8-12.1199 3.4802-16.9199 5.04z"/></svg></i></a></li><li class="text-xl hover:text-accent grid place-items-center w-5"><a title=square-github href=https://github.com/jinyongp/ target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3.0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1.0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6s-28.4 1.9-41.6 5.6c0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7.0 13.9.2 36.5.2 40.6.0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3.0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4.0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6.0-3.7-1.5s-1.1-3.2.0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3.0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"/></svg></i></a></li></ul></div></nav><main><div class=layout><header class=text-center><h1 class="relative mt-16 mb-12 flex justify-center items-center gap-2"><i class="absolute translate-y-[-1.8em] text-base md:text-lg hover:text-accent"><a title="View on GitHub Repository" href=https://github.com/nbcamp/introduce-e1if target=_blank rel="noopener noreferrer nofollow"><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8.0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8.0-21.5 4.9-32.3 14.6-51.8 45.3.0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8.0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9.0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2.0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8.0-73.5 38.7-73.5 82.6.0 87.8 80.4 101.3 150.4 101.3h48.2c70.3.0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8.0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg></i></a></i>[내배캠] 첫번째 팀 프로젝트</h1><div class="flex justify-between items-center"><div><a href=https://jinyongp.dev/tags/nbcamp><kbd class="text-xs bg-accent text-white rounded px-1 py-0.5">nbcamp</kbd></a>
<a href=https://jinyongp.dev/tags/flutter><kbd class="text-xs bg-accent text-white rounded px-1 py-0.5">flutter</kbd></a></div><span>Written on Jul 19, 2023</span></div><hr class="my-4 w-full"></header><div class="text-slate-500 grid grid-cols-1 gap-2 md:gap-20 md:grid-cols-2"><div><a title="Previous Series ([내배캠] 사전캠프)" href=/learn/nbcamp/1/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent"><div class="flex items-center gap-1 [&_span]:font-bold"><i class=mb-0.5><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M9.4 233.4c-12.5 12.5-12.5 32.8.0 45.3l160 160c12.5 12.5 32.8 12.5 45.3.0s12.5-32.8.0-45.3L109.2 288H416c17.7.0 32-14.3 32-32s-14.3-32-32-32H109.3L214.6 118.6c12.5-12.5 12.5-32.8.0-45.3s-32.8-12.5-45.3.0l-160 160z"/></svg></i><span>PREV</span></div><span class="truncate whitespace-nowrap">[내배캠] 사전캠프</span></a></div><div><a title="Next Series ([내배캠] Swift 기초 개인 과제)" href=/learn/nbcamp/3/ class="flex flex-col gap-1 border border-current text-current rounded p-2 hover:text-accent text-right"><div class="flex items-center gap-1 [&_span]:font-bold justify-end"><span>NEXT</span>
<i class=mb-0.5><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M438.6 278.6c12.5-12.5 12.5-32.8.0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3.0s-12.5 32.8.0 45.3L338.8 224H32c-17.7.0-32 14.3-32 32s14.3 32 32 32h306.7L233.4 393.4c-12.5 12.5-12.5 32.8.0 45.3s32.8 12.5 45.3.0l160-160z"/></svg></i></div><span class="truncate whitespace-nowrap">[내배캠] Swift 기초 개인 과제</span></a></div></div><hr class=my-4><article class=content><p>사전캠프에서 학습한 Flutter를 활용하여 첫번째 팀 프로젝트를 진행했습니다. (2023년 7월 10일 ~ 14일)</p><p>4일간 진행한 프로젝트로 목적은 앱 개발 전반의 과정을 익히기 위함이지만, 그보다 팀원분들과의 소통과 협업 관점에 비중으로 두고 프로젝트를 진행하였습니다.</p><p>프로젝트의 주제는 팀과 팀원의 소개를 담은 앱을 작성하는 것으로, 각자 자신의 소개를 담은 상세 페이지를 작성하고 합치기로 결정하였습니다.
저는 상세 페이지와 더불어 메인 페이지와 각 상세 페이지에서 쓰일 댓글 관리 서비스를 맡았습니다.</p><p>그 중에서도 댓글 관리 서비스를 어떻게 구현했는지 정리해보고자 합니다.</p><hr><h2 id=프로젝트-목표 class="flex items-center gap-3">프로젝트 목표 <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title="프로젝트 목표" href=#%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%eb%aa%a9%ed%91%9c><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><ul><li>앱 개발 전반의 흐름을 이해할 수 있습니다.</li><li>CRUD를 이해하고 활용할 수 있습니다.</li><li>상태 관리에 대해 이해하고 활용할 수 있습니다.</li><li>기술적 구현보다 프로젝트 진행 방법과 소통에 대해 고민해봅니다.<ul><li>와이어 프레임 설계, 기능 분담</li><li>팀원과의 소통, 협업 방법, 도움 요청 및 제공</li></ul></li></ul><h2 id=의존성-주입을-위해-인터페이스-적용하기 class="flex items-center gap-3">의존성 주입을 위해 인터페이스 적용하기 <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title="의존성 주입을 위해 인터페이스 적용하기" href=#%ec%9d%98%ec%a1%b4%ec%84%b1-%ec%a3%bc%ec%9e%85%ec%9d%84-%ec%9c%84%ed%95%b4-%ec%9d%b8%ed%84%b0%ed%8e%98%ec%9d%b4%ec%8a%a4-%ec%a0%81%ec%9a%a9%ed%95%98%ea%b8%b0><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p>사전캠프에서도 다뤘지만, Service 단에서 <code>shared_preferences</code>를 사용하기 위해 서비스 파일 내에서 직접 불러와서 사용해주는 방식이 아니라 <code>main.dart</code>에서 <code>save</code>와 <code>load</code> 함수를 주입해주는 방식으로 구현했었습니다.</p><p>허나, 아래처럼 <code>save</code> 혹은 <code>load</code> 둘 다 구현해야하는 걸 강제할 수 없었습니다. 또한, <code>shared_preferences</code>외에 다른 걸로 변경할 때도 번거롭습니다</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  SharedPreferences pref await SharedPreferences.getInstance();
  runApp(MultiProvider(
    providers: [
      ChangeNotifierProvider(
        create: (_) =&gt; MemoService(
          save: (String payload) async =&gt; await pref.setString(&#34;memo&#34;, payload),
          // load: () async =&gt; pref.getString(&#34;memo&#34;), // 에러를 발생시키지 않음
        ),
      ),
    ],
    child: const MyApp(),
  ));
}</code></pre></div><p>이를 해결하기 위해 <code>IO</code> 인터페이스를 구현했습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">abstract class IO {
  Future&lt;void&gt; save(String payload);
  Future&lt;String?&gt; load();
}</code></pre></div><p>dart에서는 인터페이스를 생성하기 위해 <code>abstract class</code> 키워드를 사용해야 합니다. <code>IO</code> 인터페이스는 <code>save</code>와 <code>load</code> 함수에 대한 명세를 제공합니다. 이를 <code>CommentService</code>에 적용합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">class CommentService extends ChangeNotifier {
  final Map&lt;String, List&lt;Comment&gt;&gt; _comments = {};

  IO? io;

  CommentService({this.io}) {
    //
  }

  ...
}</code></pre></div><p>이제 <code>io</code> 인스턴스를 외부에서 주입해줄 수 있습니다. <code>shared_preferences</code>를 사용할 예정이므로 <code>SharedPreferencesIO</code> 클래스를 생성합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">class SharedPreferencesIO implements IO {
  late Future&lt;SharedPreferences&gt; pref;

  SharedPreferencesIO() {
    pref = SharedPreferences.getInstance();
  }

  @override
  Future&lt;String?&gt; load() {
    return pref.then((pref) =&gt; pref.getString(&#39;comments&#39;));
  }

  @override
  Future&lt;void&gt; save(String payload) async {
    pref.then((pref) =&gt; pref.setString(&#39;comments&#39;, payload));
  }
}</code></pre></div><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  runApp(MultiProvider(
    providers: [
      ChangeNotifierProvider(
        create: (_) =&gt; CommentService(
          io: SharedPreferencesIO(),
        ),
      ),
    ],
    child: MainApp(),
  ));
}</code></pre></div><p>구현한 <code>SharedPreferencesIO</code> 클래스를 <code>main.dart</code>에서 <code>CommentService</code>에 주입해줍니다.</p><p>이로써, <code>save</code>와 <code>load</code> 모두 구현해야 함을 강제할 수 있게 되었고, <code>IO</code> 인터페이스를 상속하는 클래스를 여러 개 추가하여 상황에 따라 교체할 수 있어 확장성을 높였습니다.</p><h2 id=데이터-송수신-로직-추상화하기 class="flex items-center gap-3">데이터 송수신 로직 추상화하기 <i class="transition opacity-10 hover:opacity-100 text-[0.8em] scale-90 hover:scale-100 -rotate-45 hover:-rotate-90"><a title="데이터 송수신 로직 추상화하기" href=#%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%86%a1%ec%88%98%ec%8b%a0-%eb%a1%9c%ec%a7%81-%ec%b6%94%ec%83%81%ed%99%94%ed%95%98%ea%b8%b0><i><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M0 160v96C0 379.7 100.3 480 224 480s224-100.3 224-224V160H320v96c0 53-43 96-96 96s-96-43-96-96V160H0zm0-32H128V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3.0 64v64zm320 0H448V64c0-17.7-14.3-32-32-32H352c-17.7.0-32 14.3-32 32v64z"/></svg></i></a></i></h2><p><code>CommentService</code>에서 내부적으로 데이터를 저장하고 불러오는 <code>_save</code>와 <code>_load</code> 함수가 있었습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">Future&lt;void&gt; _save() {
  if (save == null) return Future.value();

  String payload = jsonEncode(_memos.map((m) =&gt; m.toJson()).toList());
  return save!(payload);
}

Future&lt;void&gt; _load() async {
  if (load == null) return;

  String? payload = await load!();
  if (payload == null) return;
  _memos.clear();

  _memos.addAll(jsonDecode(payload).map((e) =&gt; Memo.fromJson(e)));
}</code></pre></div><p>여기서 데이터를 String 타입의 payload로 만들거나, 반대로 payload를 데이터로 변환하는 작업을 수행했었습니다.
언뜻보면 null 체크를 하고 종료하는 부분이나 payload를 처리하는 부분은 중복된 부분이기에 별도의 함수로 분리하고 싶었습니다.</p><p>그래서 <code>DataHandler</code> 추상 클래스르 작성하였습니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">mixin DataHandler {
  IO? io;

  Future&lt;void&gt; import(String payload);
  Future&lt;String&gt; export();

  Future&lt;void&gt; save() async {
    if (io == null) return Future.value();
    var payload = await export();
    io?.save(payload);
  }

  Future&lt;void&gt; load() async {
    if (io == null) return Future.value();
    var payload = await io!.load();
    if (payload == null) return;
    import(payload);
  }
}</code></pre></div><p>dart에서 mixin을 활용하여 추상 클래스를 작성할 수 있습니다.
<code>save</code>와 <code>load</code> 함수는 이미 구현되어 있어 동일한 작업을 수행하지만, <code>import</code>와 <code>export</code> 함수는 재정의가 필요합니다. 이를 <code>CommentService</code>에 적용합니다.</p><div class="relative rounded-md overflow-hidden my-4 group"><small class="absolute top-0 right-0 bg-black/30 capitalize font-black text-xs text-white rounded-bl-md px-2 py-1 transition-opacity opacity-0 group-hover:opacity-100"><span class=sr-only>Language:</span>dart</small><pre><code class="hljs language-dart">class UseState {
  final List&lt;Comment&gt; comments;
  final void Function(List&lt;Comment&gt; Function()) setState;

  UseState({
    required this.comments,
    required this.setState,
  });
}

class CommentService extends ChangeNotifier with DataHandler {
  final Map&lt;String, List&lt;Comment&gt;&gt; _comments = {};

  CommentService({IO? io}) {
    this.io = io;

    try {
      load().then((_) =&gt; notifyListeners());
    } catch (error) {
      // ignore
    }
  }

  UseState useState(String name) {
    return UseState(
      comments: List.unmodifiable(_comments[name] ?? []),
      setState: (newComments) {
        _comments[name] = newComments();
        notifyListeners();
        save();
      },
    );
  }

  @override
  Future&lt;void&gt; import(String payload) async {
    jsonDecode(payload).forEach((key, values) {
      if (values is! List) return;
      _comments[key] = values.map((value) =&gt; Comment.fromJson(value)).toList();
    });
  }

  @override
  Future&lt;String&gt; export() async {
    return jsonEncode(
      _comments.map(
        (key, values) =&gt; MapEntry(
          key,
          values.map((comment) =&gt; comment.toJson()).toList(),
        ),
      ),
    );
  }
}</code></pre></div><p><code>mixin</code>을 상속하기 위해선 <code>with</code> 키워드를 사용해야 합니다. <code>DataHandler</code>를 상속하면서 <code>CommentService</code>에서 구현해야 하는 함수들을 재정의합니다.
<code>import</code>와 <code>export</code> 함수는 단순히 JSON 형태의 stringify와 parse 작업을 수행합니다. 이로써 상속을 통해 중복 코드를 제거하고 함수의 역할을 분리할 수 있었습니다.</p></article><script src=https://giscus.app/client.js data-repo=jinyongp/jinyongp.dev data-repo-id=R_kgDOHJDtcg data-category=Comments data-category-id=DIC_kwDOHJDtcs4CXf7o data-mapping=title data-strict=0 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=ko crossorigin=anonymous async></script><div class=h-24></div></div></main><footer class="absolute bottom-0 w-full"><div class="flex justify-center py-8"><p class="[&_a]:text-accent text-center text-sm">Copyright 2023. Jinyong Park. All rights reserved.<br><span class=text-xs>Powered by
<a title="Go to Hugo Site" href=https://gohugo.io target=_blank rel="noopener noreferrer nofollow">Hugo</a>
| Developed on
<a title="Go to Github Repo" href=https://github.com/jinyongp/jinyongp.github.io target=_blank rel="noopener noreferrer nofollow">Here</a></span></p></div></footer><div id=js-scroll-back-to-top class="back-to-top hide"><i class=text-accent><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><path d="M288 0c17.7.0 32 14.3 32 32V49.7C451.8 63.4 557.7 161 573.9 285.9c2 15.6-17.3 24.4-27.8 12.7C532.1 283 504.8 272 480 272c-38.7.0-71 27.5-78.4 64.1-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C359 299.5 326.7 272 288 272s-71 27.5-78.4 64.1c-1.7 8.7-8.7 15.9-17.6 15.9s-15.8-7.2-17.6-15.9C167 299.5 134.7 272 96 272c-24.8.0-52.1 11-66.1 26.7C19.4 310.4.1 301.5 2.1 285.9 18.3 161 124.2 63.4 256 49.7V32c0-17.7 14.3-32 32-32zm0 304c12.3.0 23.5 4.6 32 12.2V430.6c0 45-36.5 81.4-81.4 81.4-30.8.0-59-17.4-72.8-45l-2.3-4.7c-7.9-15.8-1.5-35 14.3-42.9s35-1.5 42.9 14.3l2.3 4.7c3 5.9 9 9.6 15.6 9.6 9.6.0 17.4-7.8 17.4-17.4V316.2c8.5-7.6 19.7-12.2 32-12.2z"/></svg></i></div></body></html>